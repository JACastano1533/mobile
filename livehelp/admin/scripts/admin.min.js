var service="../xml/WebService.php",session="",operator={},settings={},cache=false,server="",protocol=protocol,chatstack={bottom:10},notification=true,zclip=true,shortcuts=true,messagesAjax=true,autoSignIn=true,notificationIcon="images/Icon64x64.png",visitorsGrid,visitorsDataView,visitorsColumns,visitors,visitorsTimer=true,visitorsTotal=0,visitorsTimestamp="",selectedVisitor=false,defaultUserImage="/livehelp/images/UserSmall.png",websockets=false;
$.preloadImages=function(){for(var a=0;a<arguments.length;a++){$("<img>").attr("src",arguments[a]);}};function initVisitorsGrid(){if(visitorsGrid===undefined){var c=new Slick.Data.GroupItemMetadataProvider(),a={enableCellNavigation:true,enableColumnReorder:true,multiColumnSort:true,multiSelect:false};
visitorsDataView=new Slick.Data.DataView({groupItemMetadataProvider:c});if(visitorsGrid!==undefined){visitorsColumns=visitorsGrid.getColumns();}else{visitorsColumns=[{id:"browser",name:"",field:"UserAgent",width:30,resizable:false,formatter:Slick.Formatters.Browser},{id:"hostname",name:"Hostname / IP Address",field:"Hostname",width:200,sortable:true,formatter:Slick.Formatters.Hostname},{id:"status",name:"Status",field:"Active",sortable:true,formatter:Slick.Formatters.Status},{id:"location",name:"Location",field:"Country",width:150,sortable:true,formatter:Slick.Formatters.Location},{id:"pages",name:"# Pages",field:"PagePath",width:30,sortable:true,formatter:Slick.Formatters.Pages},{id:"page",name:"Current Page",field:"CurrentPage",width:290,sortable:true},{id:"referrer",name:"Referrer",field:"Referrer",width:225,sortable:true,formatter:Slick.Formatters.Referrer},{id:"pagetime",name:"Page Time",field:"TimeOnPage",width:65,sortable:true,formatter:Slick.Formatters.Seconds},{id:"sitetime",name:"Site Time",field:"TimeOnSite",width:65,sortable:true,formatter:Slick.Formatters.Seconds}];
var b=$.jStorage.get("visitorsColumns",[{id:"browser",width:30},{id:"hostname",width:200},{id:"status",width:80},{id:"location",width:150},{id:"pages",width:30},{id:"page",width:290},{id:"referrer",width:225},{id:"pagetime",width:65},{id:"sitetime",width:65}]);
$.each(b,function(e,d){$.each(visitorsColumns,function(f,g){if(d.id===g.id){g.width=d.width;return false;}});});}visitorsGrid=new Slick.Grid(".visitors-grid",visitorsDataView,visitorsColumns,a);
visitorsGrid.registerPlugin(c);visitorsGrid.setSelectionModel(new Slick.RowSelectionModel());visitorsGrid.onColumnsResized.subscribe(function(){var d=[];
$.each(visitorsGrid.getColumns(),function(e,f){d.push({id:f.id,width:f.width});});$.jStorage.set("visitorsColumns",d);});visitorsGrid.onSelectedRowsChanged.subscribe(function(){rows=visitorsGrid.getSelectedRows();
selectedVisitor=visitorsDataView.getItem(rows);if(selectedVisitor!==undefined){openVisitor(selectedVisitor);}});visitorsGrid.onSort.subscribe(function(g,d){var f=d.sortCols;
visitorsDataView.sort(function(p,o){for(var j=0,h=f.length;j<h;j++){var n=f[j].sortCol.field;var e=f[j].sortAsc?1:-1;var m=p[n],k=o[n];var q=(m==k?0:(m>k?1:-1))*e;
if(q!==0){return q;}}return 0;});visitorsGrid.invalidate();visitorsGrid.render();});visitorsDataView.onRowCountChanged.subscribe(function(h,d){visitorsGrid.updateRowCount();
visitorsGrid.render();if(selectedVisitor){var g=parseInt(selectedVisitor.ID,10);for(var f=0;f<d.current;f++){id=parseInt(visitorsDataView.mapRowsToIds([f])[0],10);
if(g===id){visitorsGrid.setSelectedRows([f]);}}}});visitorsDataView.onRowsChanged.subscribe(function(f,d){visitorsGrid.invalidateRows(d.rows);visitorsGrid.render();
});visitorsDataView.groupBy(function(e){var d="Browsing";if(e.Active<0){d="Chat Ended";}else{if(e.Session>0){d="Chatting";}}return d;},function(e){var d=" visitor";
if(e.count>1){d=" visitors";}return e.value+" - "+e.count+d;},function(e,d){return e.value-d.value;});}}function updateVisitorsGrid(g,f,e,a){var h=$('.menu a[data-type="home"].selectedMenu').length,c={enableCellNavigation:true,enableColumnReorder:true,multiColumnSort:true,multiSelect:false};
if(session.length>0){if(g===undefined){g="";}if(f===undefined){f="";}if(e===undefined||e.length===0){e=25;}var b=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Visitors":service+"?Visitors",d="Session="+session+"&Action="+g+"&Request="+f+"&Record=0&Total="+e+"&Version=4.0&Format=json";
initVisitorsGrid();$.ajax({url:b,data:d,type:"POST",success:function(j){if(j.Visitors!==null&&j.Visitors!==undefined&&j.Visitors.Visitor!==undefined){$(document).trigger("LiveHelp.VisitorsCompleted",{newVisitors:j.Visitors.Visitor,previousVisitors:visitors});
visitors=j.Visitors.Visitor;visitorsTotal=j.Visitors.TotalVisitors;visitorsTimestamp=Math.round(new Date().getTime()/1000);visitorRefreshDataView(visitors);
if(a){a(visitors);}}else{visitorRefreshDataView(null);}if(visitorsTimer===true&&websockets===false){window.setTimeout(updateVisitorsGrid,15000);}},dataType:"json",error:function(j,l,k){if(visitorsTimer===true&&websockets===false){window.setTimeout(updateVisitorsGrid,15000);
}}});}else{if(visitorsTimer===true&&websockets===false){window.setTimeout(updateVisitorsGrid,15000);}}}function visitorRefreshDataView(a){var d=$("#visitor-details .details"),e=d.data("visitor"),f=$('.menu a[data-type="home"].selectedMenu').length,g=0,b={enableCellNavigation:true,enableColumnReorder:true,multiColumnSort:true,multiSelect:false};
if(a!==null&&a!==undefined){if(e!==undefined&&d.is(":visible")){g=parseInt(e.ID,10);$.each(a,function(h,k){if(parseInt(k.ID,10)===g){d.find("#chatstatus").text(k.ChatStatus);
d.find("#currentpage a").text(k.CurrentPage).attr("href",k.CurrentPage);d.find("#pagehistory").text(k.PagePath);var j=d.find(".btn.initiate");if(k.Active.length>0){j.addClass("disabled");
}else{j.removeClass("disabled");}return false;}});}if(visitorsTotal!==undefined){updateTotal($("#visitortotal"),visitorsTotal);}$.each(a,function(h,j){var k=Math.round(new Date().getTime()/1000)-visitorsTimestamp;
j.TimeOnPage=parseInt(j.TimeOnPage,10)+k;j.TimeOnSite=parseInt(j.TimeOnSite,10)+k;});visitorsTimestamp=Math.round(new Date().getTime()/1000);visitorsDataView.beginUpdate();
visitorsDataView.setItems(a);for(var c=0;c<visitorsDataView.getGroups().length;c++){visitorsDataView.expandGroup(visitorsDataView.getGroups()[c].value);
}visitorsDataView.endUpdate();visitorsDataView.syncGridSelection(visitorsGrid,true);if(f>0&&$(".worldmap").css("display")=="none"){if(a.length>0){$(".visitors-empty").hide();
$(".visitors-grid, .visitors-menu").show();}else{$(".visitors-grid").hide();$(".visitors-empty, .visitors-menu").show();updateTotal($("#visitortotal"),0);
}}updateLocations();}else{if(f>0&&$(".worldmap").css("display")=="none"){$(".visitors-grid").hide();$(".visitors-empty, .visitors-menu").show();updateTotal($("#visitortotal"),0);
}}}function updateLocations(){var c={},g={},h={},b=[],d;if(visitors!==undefined){d=visitors.filter(function(j){if(j.Longitude!==null&&j.Latitude!==null&&j.Longitude!==undefined&&j.Latitude!==undefined&&j.Longitude.length>0&&j.Latitude.length>0){b.push(projection([j.Longitude,j.Latitude]));
return true;}return false;});var a=15;var f=locations.selectAll("g.node").data(d).attr("id",function(k,j){return parseInt(k.ID,10);}).on("click",function(j){if(j!==undefined){openVisitor(j);
}});locations.selectAll("circle.dot").data(d).attr("class","dot").attr("cx",function(k,j){return b[j][0];}).attr("cy",function(k,j){return b[j][1];}).attr("r",function(k,j){return Math.sqrt(a);
}).attr("fill","rgba(0,187,204,0.5)");locations.selectAll("circle.animate").data(d).attr("class","animate").attr("cx",function(k,j){return b[j][0];}).attr("cy",function(k,j){return b[j][1];
}).attr("r",function(k,j){return Math.sqrt(a);}).attr("fill","rgba(0,187,204,1.0)").attr("opacity",1);var e=f.enter().append("svg:g");e.data(d).attr("id",function(k,j){return parseInt(k.ID,10);
}).attr("class","node").on("click",function(j){if(j!==undefined){openVisitor(j);}});e.append("svg:circle").attr("class","dot").attr("cx",function(k,j){return b[j][0];
}).attr("cy",function(k,j){return b[j][1];}).attr("r",function(k,j){return Math.sqrt(a);}).attr("fill","rgba(0,187,204,0.5)");e.append("svg:circle").attr("class","animate").attr("cx",function(k,j){return b[j][0];
}).attr("cy",function(k,j){return b[j][1];}).attr("r",function(k,j){return Math.sqrt(a);}).attr("fill","rgba(0,187,204,1.0)").attr("opacity",1);f.exit().remove();
}}var projection,locations;function drawWorldMap(){var e=$(".worldmap");e.empty();projection=d3.geo.equirectangular().scale(e.width()).translate([e.width()/2,e.height()/2]);
var c,d=d3.geo.path().projection(projection),b=d3.select(".worldmap").append("svg:svg"),a=b.append("svg:g").attr("id","countries");locations=b.append("svg:g").attr("id","locations");
d3.json("world.json",function(g){if(g!==null){var f=a.selectAll("path").data(g.features).enter().append("svg:path").attr("d",d).attr("fill","rgba(227,227,227,1)").attr("stroke","rgba(177,175,181,1)").attr("stroke-width",1);
}});}function initWorldMap(){drawWorldMap();var a=125,b=$('.menu a[data-type="home"].selectedMenu').length;setInterval(function(){if(b>0&&$(".worldmap").css("display")=="block"){locations.selectAll("circle.animate").attr("r",function(e,c){return Math.sqrt(15);
}).attr("opacity",1).transition().duration(1000).delay(function(e,c){return c*10;}).attr("opacity",0).attr("r",function(e,c){return Math.sqrt(a);}).each("end",function(){d3.select(this).attr("opacity",1).attr("r",0);
});}},2000);}var debounceMap=function(a,b){var c=-1;return function(){if(c>-1){window.clearTimeout(c);}c=window.setTimeout(a,b);};};var debouncedWorldMap=debounceMap(function(){drawWorldMap();
updateLocations();},125);$(window).resize(debouncedWorldMap);function openVisitor(c){var b=$("#visitor-details");if(c.title===undefined){b.find(".details").data("visitor",c);
b.find("#hostname").text(convertHostname(c));b.find("#useragent").text(c.UserAgent);var d=convertBrowserIcon(c.UserAgent,false);if(b.find("#useragent-image").length===0){$('<img id="useragent-image" src="'+d+'" style="float:right; width:50px; height:50px"/>').prependTo(b.find(".useragent.value"));
}else{b.find("#useragent-image").attr("src",d);}b.find("#resolution").text(c.Resolution);b.find("#country-image").removeAttr("class").addClass(convertCountryIcon(c.Country));
b.find("#country").text(convertCountry(c));b.find("#referrer a").text(convertReferrer(c.Referrer)).attr("href",c.Referrer);b.find("#currentpage a").text(c.CurrentPage).attr("href",c.CurrentPage);
b.find("#chatstatus").text(c.ChatStatus);b.find("#pagehistory").text(c.PagePath);var a=b.find(".btn.initiate");if(c.Active.length>0){a.addClass("disabled");
}else{a.removeClass("disabled");}if(b.width()===0||b.css("display")==="none"){b.show();b.animate({width:"40%",opacity:1},250);}}}function closeVisitor(){var b=$("#visitor-details"),a=b.width();
b.animate({width:0,opacity:0},250,function(){b.hide();selectedVisitor=false;visitorsGrid.setSelectedRows([]);});}function sendInitiateChat(){var b=$(".initiate-dialog");
b.find(".progressring").show();b.find(".title").text("Sending Initiate Chat");b.find(".description").text("One moment while your initiate chat request is sent.");
b.animate({bottom:0},250,"easeInOutBack");var a=$("#visitor-details .details"),c=a.data("visitor"),d=parseInt(c.ID,10);updateVisitorsGrid("Initiate",d,25,function(e){b.animate({bottom:-90},250,"easeInOutBack");
});}var chatResponsesOpen=false,activechats=[],blockedchats=[];function checkBlocked(c){var a=false,b=$(".chat-stack .dialog");$.each(blockedchats,function(d,e){if(e.id===c){a=true;
return;}});if(!a){b.animate({bottom:"-145px"},250,function(){b.find(".unblock").hide();b.find(".progressring img").attr("src","images/ProgressRing.gif");
b.hide();});}else{b.find(".progressring img").attr("src","images/Block.png");b.find(".dialog-title").text("Chat Session Blocked");b.find(".dialog-description").text("The chat session is blocked and inactive.");
b.find(".unblock").show();b.show().animate({bottom:"1px"},250);}}var settingsMenuClickedCallback=function(b){var a=$(".settings .save.button");if(b==="htmlcode"){a.fadeOut();
}else{a.fadeIn();}};$(document).ready(function(){$(document).bind("LiveHelp.WebSocketsStateChanged",function(x,y){websockets=y;});var u=$(".chat-list .list");
$.each(u,function(x,y){var z=$(y);if(z.find(".visitor").length===0){z.data("height",noVisitorsHeight);}else{z.data("height",chattingVisitorHeight);}});
$("#history-chat .close").click(function(){closeHistory();});$(".history .search #search").keyup(function(x){if(x.which==27){$(this).val("");}historySearch=$(this).val();
updateHistoryFilter();});$(".history .search.button").click(function(){historySearch=$(".history .search #search").val();updateHistoryFilter();});$(".VisitorsTotal, #visitortotal").click(function(){switchMenu("home");
});$("#responses .close").click(function(){closeResponses();});$("#account-details .back").click(function(){showAccounts();});$(".menu li a").click(function(){var x=$(this).data("type"),y=["home","statistics","history"];
switchMenu(x);if($.inArray(x,y)>-1){$.jStorage.set("menu",x);}});$(".visitors-list.button").click(function(){$(this).css({background:"url(./images/ListHover.png) no-repeat",opacity:1});
$(".visitors-map.button").css({background:"url(./images/World.png) no-repeat",opacity:0.2});$(".worldmap").hide();if(visitors.length>0){$(".visitors-grid").fadeIn();
}else{$(".visitors-empty").fadeIn();updateTotal($("#visitortotal"),0);}});$(".visitors-map.button").click(function(){$(this).css({background:"url(./images/WorldHover.png) no-repeat",opacity:1});
$(".visitors-list.button").css({background:"url(./images/List.png) no-repeat",opacity:0.2});$(".visitors-empty, .visitors-grid").hide();$(".worldmap").fadeIn();
});$("#visitor-details button.initiate").click(function(){sendInitiateChat();});$(".notification .close").click(function(){closeNotification();return false;
});$(".settings .close, .settings .cancel").click(function(){closeSettings();return false;});$(".settings .save").on("click",function(x){saveSettings();
x.stopPropagation();});$(".settingsmenu div").click(function(){var z=$(this).attr("id"),x=$(".settings-"+z),y=x.parent().find(".section");settingsMenuClickedCallback(z);
x.show();$.each(y,function(B,C){var A=$(C);if(A.attr("class").indexOf("settings-"+z)==-1){A.hide();}});});$(".settingsmenu #htmlcode").click(function(){$(document).trigger("LiveHelp.SettingsHTMLCodeClick");
if(zclip){$(".copy.step1").zclip("remove");$(".copy.step1").zclip({path:"scripts/ZeroClipboard.swf",copy:function(){return $("textarea#htmlcodestep1").val();
},afterCopy:function(){$("textarea#htmlcodestep1").pulse({backgroundColor:["#dbf3f8","#ffffff"]},500,2);}});$(".copy.step2").zclip("remove");$(".copy.step2").zclip({path:"scripts/ZeroClipboard.swf",copy:function(){return $("textarea#htmlcodestep2").val();
},afterCopy:function(){$("textarea#htmlcodestep2").pulse({backgroundColor:["#dbf3f8","#ffffff"]},500,2);}});}});$(".dropdown-toggle").dropdown();$(".operator li").click(function(){var x=$(this).find("a").text();
$(".operator .status").text(x);});$("#calendar").ical();$("#calendar").on("click","td",function(){var x=$(this).attr("id"),y=$(this);if(x!==undefined&&x.length>0&&/^\d{4}-\d{2}-\d{2}$/i.test(x)){$.jStorage.set("history-date",x);
y.closest("table").find("td").removeClass("selected-date");y.addClass("selected-date");initHistoryGrid(x);}});var n=$("#history-chat");n.find(".btn.unblock").click(function(){var x=n.data("id"),y=n.find(".dialog");
unblockChat(x,y);});var t=$(".chat-stack");t.find(".dialog .btn.unblock").click(function(){var z=t.find(".chat"),y=t.find(".dialog"),x;$.each(z,function(A,B){if($(B).position().left===0){x=$(B);
return;}});if(x!==undefined&&x.length>0){x=x.data("id");unblockChat(x,y);}});t.on("click",".chat",function(){var B=$(this),D=B.data("id"),C={top:parseInt(B.css("top"),10),left:parseInt(B.css("left"),10),bottom:parseInt(B.css("bottom"),10)},z=parseInt(B.css("z-index"),10),x=B.find(".scroll"),A=B.find(".message-alert").data("total");
if(z!=500){$(".chat-stack .chat").each(function(F,G){var E=$(G),H=parseInt(E.position().left,10);if(H===0){$(E).data("scroll",E.find(".scroll").scrollTop());
}});B.animate({"z-index":500,left:0,bottom:0,top:0,backgroundColor:"#fffff"},150,"easeInOutBack",function(){B.find(".inputs, input").fadeIn();B.find(".inputs input").focus();
var E=B.data("scroll");if(A>0){E=B.find(".scroll .end");}var F=$(".chatting .visitor"),H=$(".chat-stack .dropdown-menu.options"),G=B.data("id");$.each(F,function(J,K){if($(K).data("id")===G){var I=$('.chatting .visitor[data-id="'+G+'"]').data("user").Email,L=H.find(".EmailChatVisitor");
L.text("Visitor's Email Address ("+I+")").data("email",I);L.data("id",G);return;}});checkBlocked(G);if(E!==undefined){B.find(".scroll").scrollTo(E);}});
$(".chat-stack .smilies.button").close();B.find(".name").hide();var y=B.find(".message-alert");$(y).data("total",0).hide();$(".chat-stack .chat").each(function(I,J){var H=$(J),L=parseInt(H.css("left"),10),E=parseInt(H.css("z-index"),10),K=0,G=2,F="#fafafa";
if(L<C.left){if(L>0){K=0;G=4;F="#f6f6f6";}H.animate({"z-index":E-10,top:K,left:L+35,bottom:G,backgroundColor:F},150,"easeInOutBack");H.find(".inputs, input").fadeOut();
H.find(".name").fadeIn();}});x.scrollTo(x.find(".end"));}});$("#visitor-details .close").click(function(){closeVisitor();});var g="body, input, textarea";
$(g).bind("keydown","esc",function(){if(shortcuts){processEscKeyDown();}});$(g).bind("keydown","ctrl+shift+s",function(){if(shortcuts){openSettings();}});
$(g).bind("keydown","ctrl+shift+a",function(){if(shortcuts){openAccounts();}});$(g).bind("keydown","ctrl+shift+r",function(){if(shortcuts){openResponses();
}});$("#account-details .close").click(function(){closeAccount();});$("#response-list").on({mouseenter:function(){var x=$(this).find(".edit");if(activechats.length>0&&$(".chat-stack").position().top>=0){x=$(this).find(".edit, .send");
}x.animate({opacity:0.3},250);},mouseleave:function(){var x=$(this).find(".edit");if(activechats.length>0&&$(".chat-stack").position().top>=0){x=$(this).find(".edit, .send");
}x.animate({opacity:0},250);}},".response");$("#response-list").on({mouseenter:function(){if(activechats.length>0&&$(".chat-stack").position().top>=0){var x=$(this);
x.animate({opacity:0.6},250);}},mouseleave:function(){if(activechats.length>0&&$(".chat-stack").position().top>=0){var x=$(this);x.animate({opacity:0.3},250);
}}},".response .edit, .response .send");$("#response-list").on("click",".response .edit",function(){var y=$(this).closest(".response"),B=y.data("id"),A=$("#responses #add-response"),z=["Text","Hyperlink","Image","PUSH","JavaScript"];
y=[];$.each(responses,function(C,D){if($.inArray(C,z)>-1){$.each(D,function(E,F){if(parseInt(F.ID,10)===B){y=F;return false;}});}});$("#ResponseID").val(y.ID);
$("#ResponseName").val(y.Name);$("#ResponseCategory").val(y.Category);var x="Text";switch(y.Type){case 2:x="Hyperlink";break;case 3:x="Image";break;case 4:x="PUSH";
break;case 5:x="JavaScript";break;}$("#ResponseType"+x).attr("checked","checked");if(x==="Text"){$("#ResponseContent").val(y.Content);$("#add-response .URL").hide();
$("#add-response .Content").show();}else{$("#ResponseURL").val(y.Content);$("#add-response .Content").hide();$("#add-response .URL").val(y.Content).show();
}$(".add-response.tags").html("");m(y.Tags);k();});$(".chat-stack .smilies.button").on({mouseenter:function(){$(this).css("background","url(images/SmiliesHover.png)");
},mouseleave:function(){$(this).css("background","url(images/Smilies.png)");},click:function(){$(this).bubbletip($("#SmiliesTooltip"),{calculateOnShow:true}).open();
}});$(".chat-stack").on("focus","#message",function(){$(".chat-stack .smilies.button").close();});$("#SmiliesTooltip span").click(function(){var y=$(this).attr("class").replace("sprite ",""),A="",x=$(".chat-stack textarea"),z=x.val();
switch(y){case"Laugh":A=":D";break;case"Smile":A=":)";break;case"Sad":A=":(";break;case"Money":A="$)";break;case"Impish":A=":P";break;case"Sweat":A=":\\";
break;case"Cool":A="8)";break;case"Frown":A=">:L";break;case"Wink":A=";)";break;case"Surprise":A=":O";break;case"Woo":A="8-)";break;case"Tired":A="X-(";
break;case"Shock":A="8-O";break;case"Hysterical":A="xD";break;case"Kissed":A=":-*";break;case"Dizzy":A=":S";break;case"Celebrate":A="+O)";break;case"Angry":A=">:O";
break;case"Adore":A="<3";break;case"Sleep":A="zzZ";break;case"Stop":A=":X";break;}x.val(z+A).keyup();});loadResponses();var l=$("#responses");l.find("input").on("keydown","#search","return",filterResponses);
l.click(filterResponses);function k(){l.find(".back, .back-background").fadeIn();l.find("#add-response").fadeIn();l.find(".header").text("Add Response");
l.find(".search, #response-list, .button-toolbar.add").hide();l.find(".button-toolbar.save").fadeIn().animate({bottom:"15px"},250,"easeInOutBack");}l.find(".add-small, .add.button").click(function(){b();
k();});function b(){l.find("#ResponseID").val("");l.find("#ResponseName").val("");l.find("#ResponseCategory").val("");l.find("#ResponseTypeText").attr("checked","checked");
l.find("#ResponseURL").val("");l.find("#ResponseContent").val("");l.find("#ResponseTags").val("");l.find(".add-response.tags").html("");l.find(".URL").hide();
l.find(".Content").show();l.find(".InputError").hide();}l.find(".cancel.button").click(function(){b();w();});var j=l.find(".confirm-delete");l.find(".delete-button").click(function(){j.find(".progressring img").css({opacity:0});
j.find(".buttons").show();j.find(".title").text("Confirm Response Delete");j.find(".description").text("Are you sure that you wish to delete this response?");
j.animate({bottom:0},250,"easeInOutBack");});j.find(".delete").click(function(){j.find(".buttons").fadeOut();j.find(".progressring img").css({opacity:0.5});
d();});j.find(".cancel").click(function(){j.animate({bottom:"-90px"},250,"easeInOutBack");});l.find("#ResponseName").on("keydown keyup change blur",function(){var x=$(this).attr("id");
validateField($(this),"#"+x+"Error");});l.find("#ResponseTypeText, #ResponseTypeJavaScript").on("click",function(){if($(this).is(":checked")){l.find(".URL").hide();
l.find(".Content").show();}});l.find("#ResponseTypeHyperlink, #ResponseTypeImage, #ResponseTypePUSH").on("click",function(){if($(this).is(":checked")){l.find(".Content").hide();
l.find(".URL").show();}});function e(x){if(l.find("#ResponseTypeHyperlink, #ResponseTypePUSH, #ResponseTypeImage").is(":checked")){if(/^(?:\b(https?|file):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$])$/i.test(x)){l.find("#ResponseURLError").removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);
}else{l.find("#ResponseURLError").removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);}}}l.find("#ResponseContent, #ResponseURL").on("keydown keyup change blur",function(){var y=l.find(".checkbox input:checked").data("type"),x=l.find("#ResponseURL"),z=l.find("#ResponseContent");
if(y==="Text"||y==="JavaScript"){validateField(z,"#ResponseContentError");}else{e(x.val());}});function d(){var z=l.find("#ResponseID");function y(A){if(A!==undefined&&A.Responses!==undefined){updateResponses(A.Responses);
}b();w();$("#responses .confirm-delete").animate({bottom:-90},250,"easeInOutBack");}if(l.find(".CrossSmall").length===0){var x={Session:session,ID:z.val(),Version:"4.0",Format:"json"};
$.ajax({url:(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Responses":service+"?Responses",data:x,type:"POST",success:function(A){y(A);
},dataType:"json"});}}function q(){var z=l.find("#ResponseID"),x=l.find("#ResponseName"),A=l.find("#ResponseCategory"),D=l.find(".checkbox input:checked").data("type"),y=l.find("#ResponseURL"),C=l.find("#ResponseContent"),G=l.find("#ResponseTags"),H=true;
validateField(x,"#ResponseNameError");if(D==="Text"||D==="JavaScript"){validateField(C,"#ResponseContentError");C=C.val();}else{e(y.val());C=y.val();}function E(I){if(I!==undefined&&I.Responses!==undefined){updateResponses(I.Responses);
}b();w();}if(l.find(".CrossSmall").length===0){switch(D){case"Text":D=1;break;case"Hyperlink":D=2;break;case"Image":D=3;break;case"PUSH":D=4;break;case"JavaScript":D=5;
break;}var G=[],F="";$.each(l.find(".add-response .tag"),function(I,J){F=$(J).text();if(F.length>0&&$.inArray(J,G)===-1){G.push(F.toLowerCase());}});G=G.join(";");
var B={Session:session,ID:z.val(),Name:x.val(),Category:A.val(),Content:C,Type:D,Tags:G,Version:"4.0",Format:"json"};$.ajax({url:(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Responses":service+"?Responses",data:B,type:"POST",success:function(I){E(I);
},dataType:"json"});}}l.find(".save.button").click(function(){q();});function m(x){if(x!==undefined&&x.length>0){$.each(x,function(z,y){l.find(".add-response.tags").append('<span class="tag"><span class="tag-icon"></span>'+y.trim()+'<span class="delete" title="Delete"></span></span>');
});}}l.find(".add-tag").click(function(){var y=l.find("#ResponseTags"),x=y.val().split(" ");m(x);y.val("");});$("#responses").on({mouseenter:function(){$(this).find(".delete").css({opacity:0.3});
},mouseleave:function(){$(this).find(".delete").css({opacity:0.1});}},".add-response.tags .tag");$("#responses").on("click",".tag .delete",function(){$(this).closest(".add-response.tags .tag").remove();
});function w(){l=$("#responses");l.find("#add-response").fadeOut();l.find(".header").text("Pre-typed Response");l.find(".back, .back-background").fadeOut();
var y=l.find(".button-toolbar.save"),x=y.height();y.hide().css("bottom",-x+"px");l.find(".search, #response-list, .button-toolbar.add").fadeIn(250,function(){$("#response-list .response, #responses .button-toolbar.add").show();
});}l.find(".back").click(function(){w();});$(".chat-stack").on("click",".search",function(){chatResponsesOpen=true;openResponses(function(){$("#responses #search").focus();
});});$(document).bind("LiveHelp.AccountsUpdated",function(z,y){var x=$(".operators.list .visitor");$.each(x,function(B,C){var A=$(C),D=A.data("id");$.each(y,function(F,G){if(parseInt(G.ID,10)==D){A.find(".name").text(G.Firstname);
A.find(".department").text(G.Department);var E=convertAccessLevel(G.Privilege);A.find(".accesslevel").text(E);}});});});updateUsers();function f(z){var x=$(".chat-stack .chat[data-id="+z+"]").find(".scroll"),y=x.find("div.end");
x.scrollTo(y);}function r(B,y){var A=y.split(" "),x="",z=false;$.each(A,function(C,D){D=D.replace(/[;?.\-,!]/ig,"");if($.inArray(D.toLowerCase(),tags)>-1){z=true;
}});if(z){x='<div class="responses-menu" data-message="'+B+'"><div class="close"></div><div style="font-size:28px; color:#999; padding:10px">Pre-typed Responses (<span class="tag-text"></span>)</div><div class="responses-text-heading" style="font-size:20px; color:#999; padding:5px 10px">Text</div><div class="responses-text" style="font-size:12px; color:#666; padding:10px"></div><div class="responses-hyperlink-heading" style="font-size:20px; color:#999; padding:5px 10px">Hyperlink</div><div class="responses-hyperlink" style="font-size:12px; color:#666; padding:10px"></div><div class="responses-image-heading" style="font-size:20px; color:#999; padding:5px 10px">Image</div><div class="responses-image" style="font-size:12px; color:#666; padding:10px"></div><div class="responses-push-heading" style="font-size:20px; color:#999; padding:5px 10px">PUSH</div><div class="responses-push" style="font-size:12px; color:#666; padding:10px"></div><div class="responses-javascript-heading" style="font-size:20px; color:#999; padding:5px 10px">JavaScript</div><div class="responses-javascript" style="font-size:12px; color:#666; padding:10px"></div></div>';
}return x;}function p(B,z){var A=z.split(" "),y="",x=[];y=z;$.each(A,function(C,D){D=D.replace(/[;?.\-,!]/ig,"");if($.inArray(D.toLowerCase(),tags)>-1&&$.inArray(D.toLowerCase(),x)===-1){y=y.replace(D,'<span class="tag" data-message="'+B+'"><span class="icon"></span><span class="text">'+D+"</span></span>");
x.push(D.toLowerCase());}});return y;}(function v(){if(session.length>0&&messagesAjax){var y=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Chats":service+"?Chats",z="Session="+session+"&Version=4.0",x=$(".chat-stack"),B=x.find(".chat");
$.each(B,function(F,H){var D=$(H),I=D.data("id"),C=D.data("closed"),G=false,E=false;$.each(activechats,function(J,K){if(K.id===I){G=true;return;}});$.each(blockedchats,function(J,K){if(K.id===I){E=true;
return;}});if(!G&&!E&&!C){activechats.push({id:I,typing:0,type:0,message:0});}});if(activechats.length>0){var A="";$.each(activechats,function(D,C){if(A.length>0){A+="|";
}A+=C.id+","+C.typing+","+C.type+","+C.message;});z+="&Data="+A+"&Format=json";$.ajax({url:y,data:z,type:"POST",success:function(G){var H=false,E="",D={},C=$(".chat"),F;
$.each(C,function(I,J){if($(this).position().left===0){F=parseInt($(this).data("id"),10);return false;}});if(G.MultipleMessages!==undefined&&G.MultipleMessages.Messages!==undefined){$.each(G.MultipleMessages.Messages,function(P,K){if(K!==undefined){var I=parseInt(K.ID,10),L=parseInt(K.Status,10),R=K.Typing,T=$(".chat-stack .chat[data-id="+I+"]"),N="left",O=0,J=0,S=$(".chat-stack .typing");
$.each(activechats,function(U,V){if(V.id!==undefined&&V.id==I){V.typing=R;if(V.id==F&&(V.typing==1||V.typing==3)){S.show();}else{S.hide();}return false;
}});E="";if(K.Message!==undefined&&K.Message.length>0){$.each(K.Message,function(ae,ad){var U=parseInt(ad.ID,10),Z=parseInt(ad.Status,10),ag=ad.Content,X=new moment(ad.Datetime,"YYYY-MM-DD HH-mm:ss").toDate(),W=X.getHours()+":"+zeroFill(X.getMinutes(),2);
if(Z>0){ag=$("<div>").text(ag).html();}if(Z===3){var af=/(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)/im;
var ac=af.exec(ag);if(ac!==null){ag='<img src="'+ac[0]+'" />';}}else{ag=ag.replace(/(?!.*(?:\.jpe?g|\.gif|\.png)$)((?:(?:http(?:s?))|(?:ftp)):\/\/[^\s|<|>|'|"]*)/img,'<a href="$1" target="_blank">$1</a>');
ag=ag.replace(/^(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)$/img,'<img src="$&"/>');}ag=ag.replace(/(\r\n|\r|\n)/g,"<br/>");
if(settings.Smilies!==0){ag=htmlSmilies(ag);}var ab=ad.Username;if(Z===1&&accounts!==undefined){$.each(accounts.Operator,function(ah,ai){if(ai.Username===ab){ab=ai.Firstname;
return;}});}ab=(ab.length>0)?"from "+capitaliseFirstLetter(ab):"";N=(Z>0)?"right":"left";if(Z===0){E+='<blockquote class="message '+N+'"><div style="margin-bottom: 3px">'+p(U,ag)+'</div><div style="bottom:5px; right:5px; font-size:11px; float:right">'+ab+" at "+W+"</div></blockquote>";
E+=r(U,ag);O++;D={id:I,username:ab,message:ag};}else{if(Z>=0){E+='<blockquote class="message '+N+'"><div style="margin-bottom: 3px">'+ag+'</div><div style="bottom:5px; right:5px; font-size:11px; float:right">'+ab+" at "+W+"</div></blockquote>";
}else{if(Z===-2){E+='<div style="color:#666; font-size:12px; margin-left:20px; line-height:20px"><img src="http://'+server+'/livehelp/image.php?SIZE=20" style="float:left; margin-right:5px"/>'+capitaliseFirstLetter(ag)+"</div>";
}else{if(Z===-3){var Y=parseInt(ag.substring(ag.length-1),10),V="";for(var aa=1;aa<=5;aa++){if(Y>=aa){V+='<div class="rating-highlight"></div>';}else{V+='<div class="rating"></div>';
}}ag=ag.substring(0,ag.length-2);switch(Y){case 5:Y="Excellent";break;case 4:Y="Very Good";break;case 3:Y="Good";break;case 2:Y="Poor";break;case 1:Y="Very Poor";
break;}E+='<div style="margin-left:20px">'+ag+"<span>"+V+'<span style="margin-left:10px">'+Y+"</span></span></div>";}}}}$.each(activechats,function(ah,ai){if(ai.id===I){ai.message=parseInt(ad.ID,10);
J=ai.message;activechats[ah]=ai;return;}});});}var M=T.data("closed");if(L===-1&&!M){E='<div style="margin-left:20px; text-align: center">The chat session has been closed.</div>';
T.data("closed",true);B=[];$.each(activechats,function(U,V){if(V.id!==I){B.push(V);return;}});activechats=B;}if(E.length>0&&!M){$(E).appendTo(T.find(".messages"));
E="";f(I);if(O>0){H=true;}if($(".chat-stack").position().top===0&&J>0){$("#chatting .visitor[data-id="+I+"]").data("messages",J);}if(parseInt(T.css("left"),10)>0&&O>0){var Q=T.find(".message-alert");
O=parseInt($(Q).data("total"),10)+O;$(Q).data("total",O);Q.text(O).show();}}}});}if(H&&messageSound!==undefined){messageSound.play();$(document).trigger("LiveHelp.PlayMessageSound",D);
H=false;}},dataType:"json"});}}window.setTimeout(v,2000);})();$(".chat-stack .send").on({click:function(){sendMessage();var x=$(".responses-menu");if(x.css("display")!="none"){x.height(0).hide();
}return false;},mouseenter:function(){$(this).css({opacity:1}).removeClass("sprite SendButton").addClass("sprite SendButtonHover");},mouseleave:function(){$(this).css({opacity:0.4}).removeClass("sprite SendButtonHover").addClass("sprite SendButton");
}});var o=$(".chat-stack textarea");o.bind("keydown","return",function(){sendMessage();return false;}).bind("keyup","return",function(){h(false);}).bind("focusout",function(){h(false);
}).bind("keydown","ctrl+return",function(){var y=$(this),z=y.val(),A=y.caret().start,x=y.caret().end;y.val(z.substr(0,A)+"\n"+z.substr(x)).caret(A+1,A+1);
return false;}).bind("keydown",function(){h(true);});function h(x){var A=$(".chat"),z=0,y;$.each(A,function(B,C){if($(this).position().left===0){z=parseInt($(this).data("id"),10);
return false;}});$.each(activechats,function(B,C){if(C.id!==undefined&&C.id==z){if(x){switch(C.typing){case 0:y=2;break;case 1:y=3;break;case 2:y=2;break;
case 3:y=3;break;}}else{switch(C.typing){case 0:y=0;break;case 1:y=1;break;case 2:y=0;break;case 3:y=1;break;}}C.typing=y;return false;}});}function c(){var y=$(this),D=y.data("message"),C=$(".responses-menu[data-message="+D+"]"),x=300,A=1,z=y.find(".text").text();
if(C.length===0){C=y.parent();}if(C.height()>0){x=0;A=0;}else{var B=0;C.find(".responses-text, .responses-hyperlink, .responses-image, .responses-push, .responses-javascript").html("").hide();
C.find(".responses-text-heading, .responses-hyperlink-heading, .responses-image-heading, .responses-push-heading, .responses-javascript-heading").hide();
$.each(responses,function(F,E){if(F==="Text"){B=0;$.each(E,function(G,H){$.each(H.Tags,function(K,I){I=I.toLowerCase();if(I===z.toLowerCase()){var J='<div class="response">'+H.Content+"</div>";
C.find(".tag-text").text(I);$(J).appendTo(C.find(".responses-text"));B++;}});});if(B>0){C.find(".responses-text-heading, .responses-text").show();}}else{if(F==="Hyperlink"){B=0;
$.each(E,function(G,H){$.each(H.Tags,function(K,I){I=I.toLowerCase();if(I===z.toLowerCase()){var J='<div class="response">'+H.Content+"</div>";C.find(".tag-text").text(I);
$(J).appendTo(C.find(".responses-hyperlink"));B++;}});});if(B>0){C.find(".responses-hyperlink-heading, .responses-hyperlink").show();}}else{if(F==="Image"){B=0;
$.each(E,function(G,H){$.each(H.Tags,function(K,I){I=I.toLowerCase();if(I===z.toLowerCase()){var J='<div class="response">'+H.Content+"</div>";C.find(".tag-text").text(I);
$(J).appendTo(C.find(".responses-image"));B++;}});});if(B>0){C.find(".responses-image-heading, .responses-image").show();}}else{if(F==="PUSH"){B=0;$.each(E,function(G,H){$.each(H.Tags,function(K,I){I=I.toLowerCase();
if(I===z.toLowerCase()){var J='<div class="response">'+H.Content+"</div>";C.find(".tag-text").text(I);$(J).appendTo(C.find(".responses-push"));B++;}});
});if(B>0){C.find(".responses-push-heading, .responses-push").show();}}else{if(F==="JavaScript"){B=0;$.each(E,function(G,H){$.each(H.Tags,function(K,I){I=I.toLowerCase();
if(I===z.toLowerCase()){var J='<div class="response">'+H.Content+"</div>";C.find(".tag-text").text(I);$(J).appendTo(C.find(".responses-javascript"));B++;
}});});if(B>0){C.find(".responses-javascript-heading, .responses-javascript").show();}}}}}}});x="100%";}C.animate({height:x,opacity:A},250,"easeOutBack",function(){$(this).toggle();
var E=$(this).closest(".chat").data("id");f(E);});}$(".chat-stack").on("click",".responses-menu .response",function(){$(".chat-stack textarea").val($(this).text());
});$(document).on("click",".messages .tag, .responses-menu > .close",c);$(".chat-list-heading").click(function(){var y=$(this).next(),x=y.height();if(x===0){x=y.data("height");
}else{y.data("height",x);x=0;}toggleChatMenu(y,x);});$(".reset.password").on("click",function(){$(".login .signin.form, .btn-toolbar.signin, .login .error").hide();
$(".login .reset.form, .btn-toolbar.reset").show();$(".login .reset.form #username").focus();});function s(){$(".login .reset.form, .btn-toolbar.reset, .login .error").hide();
$(".login .signin.form, .btn-toolbar.signin").show();$(".login .signin.form #username").focus();}var a=$(".btn-toolbar.reset");a.find(".btn.back").on("click",function(){s();
});a.find(".btn.reset").on("click",function(){var y=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Login":service+"?ResetPassword",A=$(".reset.form"),B=A.find("#username").val(),x=A.find("#email").val(),z={Username:B,Email:x,Version:"4.0",Format:"json"};
$.ajax({url:y,data:z,type:"POST",success:function(C){s();},error:function(F,D,E){var C=$(".login, .inputs");$(".login .error .text").text("Incorrect Username or Email");
C.find(".error").fadeIn();C.effect("shake",{times:3,distance:10},150);},dataType:"xml"});});initAdmin();});function initAdmin(){$(".loading").delay(500).fadeOut();
var d=$.jStorage.get("session","");if(d.length>0){session=d;if(autoSignIn){signIn();}$(document).trigger("LiveHelp.AutoSignIn");}else{$(".login").fadeIn();
}$("div.metro-pivot").metroPivot({selectedItemChanged:function(f){showVisitorChart();showChatChart();},controlInitialized:function(){}});$.preloadImages("images/bubbletip/bubbletip.png");
$(".twofactor .factor").hover(function(){$(this).find("span, img").animate({opacity:1},250);},function(){if(!$(this).data("selected")){$(this).find("span").animate({opacity:0},250);
$(this).find("img").animate({opacity:0.5},250);}}).click(function(){var g=$(".twofactorcode"),f=$(".login");factor=$(this).data("factor");$(this).parent().find(".factor").each(function(j,k){var h=$(k);
if(h.data("factor")!==factor){h.data("selected",false).find("img").animate({opacity:0.5},250);h.find("span").animate({opacity:0},250);}});$(this).data("selected",true).find("span, img").animate({opacity:1},250);
g.fadeIn();if(factor==="push"){g.find(".code").fadeOut(function(){g.find(".status span").text("Authenticate to send Duo PUSH request");g.find(".status, .status img").fadeIn();
});}else{if(factor==="sms"||factor==="token"){if(factor==="sms"){g.find(".code label").text("SMS Code");g.find(".hint-token").hide();g.find(".hint-sms").show();
}else{g.find(".code label").text("Token Code");g.find(".hint-sms").hide();g.find(".hint-token").text("Enter your hardware token code or Duo Mobile code").show();
}g.find(".status").fadeOut(function(){g.find(".code").fadeIn(function(){$("#twofactor").focus();});});}}$("#twofactor").focus();});$(".login input").keypress(function(f){if(f.which===13){signIn();
f.preventDefault();}});$(".login .signin.btn").click(function(){signIn();});$(".login .clear").click(function(){var f=$(".login .inputs");f.find(".server input, .username input, .password input").val("");
f.find(".server input").focus();});var e=$("#account-details");var a=false;$(document).bind("dragover",function(h){var f=$("#account-dropzone, #account-upload"),j=$("#account-upload"),g=window.dropZoneTimeout;
if(!g){j.addClass("in");}else{clearTimeout(g);}if($.inArray(h.target,f)>-1){j.addClass("hover");if(!a){j.pulse({backgroundColor:["#e6f7fa","#ffffff"]},500,2,function(){a=false;
$(this).css("background","transparent");});a=true;}}else{j.removeClass("hover");}window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null;
j.removeClass("in hover");},100);});function c(f){if(f.preventDefault){f.preventDefault();}if(f.stopPropagation){f.stopPropagation();}if(f.dataTransfer!==undefined){f.dataTransfer.dropEffect="copy";
}return false;}$(document).bind("drop",function(k){c(k.originalEvent);var j=k.originalEvent.dataTransfer,h=j.files;if(j.files.length>0){var g=j.files[0],f=new FileReader();
f.onload=function(l){updateAccountImage(l.target.result);};accountFiles=g;f.readAsDataURL(g);}});$(document).bind("drop dragover",function(f){f.preventDefault();
});$("#account-upload").fileupload({url:(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Operators":service+"?Operators",dataType:"json",singleFileUploads:true,dropZone:$("#account-dropzone"),submit:function(g,f){return false;
}});e.find(".edit-button").click(function(){var h=$("#account-details"),g=h.find(".button-toolbar.edit"),f=h.find(".button-toolbar.edit").height();g.hide().css("bottom",-f+"px");
h.find(".value, .label.devices").hide();h.find(".LiveHelpInput, .password").fadeIn();h.find(".button-toolbar.save").fadeIn().animate({bottom:"15px"},250,"easeInOutBack");
h.find(".InputError").removeClass("TickSmall CrossSmall");});e.find(".cancel-button").click(closeAccountDetails);e.find(".add-button").click(function(){showAddAccount();
});e.find(".save-button").click(function(){var f=$("#account-details .header").text();if(f==="Add Account"){addAccount();}else{saveAccount();}});e.find("input, select, .password").filter(":not(#AccountUsername, #AccountEmail, #ConfirmPassword)").on("keydown keyup change blur",function(){var f=$(this).attr("id");
validateField($(this),"#"+f+"Error");});e.find("#AccountUsername").on("keydown keyup change blur",function(){var f=$(this).attr("id");validateUsername($(this),"#"+f+"Error");
});e.find("#AccountEmail").on("keydown keyup change blur",function(){var f=$(this).attr("id");validateEmail($(this),"#"+f+"Error");});e.find("#AccountPasswordConfirm").on("keydown keyup change blur",function(){var f=$(this).attr("id");
validatePassword($(this),$("#AccountPassword").val(),"#"+f+"Error");});var b=e.find(".confirm-delete");e.find(".delete-button").click(function(){b.animate({bottom:0},250,"easeInOutBack");
});b.find(".delete").click(function(){b.find(".buttons").fadeOut();b.find(".progressring img").css({opacity:0.5});deleteAccount();});b.find(".cancel").click(function(){b.animate({bottom:"-90px"},250,"easeInOutBack");
});$(".operator").on("click",".dropdown-menu.statusmode a",function(){var f=$(this).attr("class");if(f!=="Signout"&&f!=="Settings"&&f!=="Billing"){updateUsers(f,undefined,function(){refreshAccounts(f);
});}else{if(f==="Settings"){switchMenu("settings");$(".operator .dropdown-toggle").dropdown("toggle");return false;}else{if(f==="Billing"){openBilling();
$(".operator .dropdown-toggle").dropdown("toggle");return false;}else{signOut();}}}});$("#pending").on("click",".visitor",$(this),function(g){var f=($(g.target).is(".visitor"))?$(g.target):$(g.target).parent();
acceptChat(f);closeNotification();});$(document).on("click",".chatting .visitor, .other-chatting .visitor",function(){var g=$(this).data("id"),f=$(this).data("user");
openChat(g,f);});$(".chat-stack").on("click",".chat .inputs > .close",function(){closeChats();if(chatResponsesOpen){closeResponses();chatResponsesOpen=false;
}});$(window).resize(function(){if(historyGrid!==undefined){historyGrid.resizeCanvas();}if(accountsGrid!==undefined){accountsGrid.resizeCanvas();}if(visitorsGrid!==undefined){visitorsGrid.resizeCanvas();
}});$("#responses").on("click",".response",function(l){if(activechats.length>0&&$(".chat-stack").position().top>=0){var m=$(l.target).closest(".response").data("id"),g=["Text","Hyperlink","Image","PUSH","JavaScript"],f,h;
$.each(responses,function(o,n){if($.inArray(o,g)>-1){$.each(n,function(p,q){if(m===parseInt(q.ID,10)){f=q;h=o;return;}});}});if(f!==undefined){var k=$(".chat-stack #message"),j=f.Content;
if(h==="Hyperlink"||h==="PUSH"){j=f.Name+" - "+f.Content;}k.val(j).keyup();}}});$("#responses").on("click",".response .send",function(){var j=$(this).closest(".response").data("id"),g=["Text","Hyperlink","Image","PUSH","JavaScript"],f,h;
$.each(responses,function(l,k){if($.inArray(l,g)>-1){$.each(k,function(m,n){if(j===parseInt(n.ID,10)){f=n;h=l;return;}});}});return sendResponse(h,f);});
}function sendResponse(c,b){var e=$(".chat-stack .chat"),a;$.each(e,function(f,g){if($(g).position().left===0){a=$(g);return;}});if(a!==undefined&&a.length>0){if(c==="Text"){sendMessage(b.Content);
return false;}else{var d=a.data("id");sendCommand(d,c.toUpperCase(),b.Name,b.Content);return false;}}return false;}function acceptChat(c){var d=c.find(".details.name"),e=c.data("id"),b=d.text();
$(document).trigger("LiveHelp.AcceptChat",{id:parseInt(e,10),name:d});var a=-1;$.each(notifications,function(f,g){if(c.data("id")===g.id){a=f;g.notification.cancel();
return false;}});if(typeof notifications[a]!=="undefined"){notifications.splice(a,1);}c.css("background","#e2e2e2");d.text("Accepting Chat");c.find(".details.department").text("with "+b);
c.find(".image").css({background:"url(images/ProgressRing.gif) no-repeat",opacity:0.5,border:"none","box-shadow":"none"});c.find(".details.accesslevel").html("&nbsp;");
c.delay(3000).fadeOut(function(){$(this).remove();});if(e>0){updateUsers("Accept",e);}}var visitorChart,visitorChartData=[],visitorChartCursor,visitorChartEmpty=false;
function showVisitorChart(){var b="#54c2ea";var f=1;if(visitorChartData.length===0){for(var c=30;c>0;c--){var a=new Date(),k=Math.floor(Math.random()*(80-30+1))+30,e=Math.floor(Math.random()*(250-120+1))+120;
a.setDate(a.getDate()-c);visitorChartData.push({date:a,chats:k,visits:e});}visitorChartEmpty=true;}if(visitorChartEmpty){b="#cccccc";f=0.5;}$("#visitor-chart").parent().css("opacity",f);
visitorChart=new AmCharts.AmSerialChart();visitorChart.dataProvider=visitorChartData;visitorChart.categoryField="date";visitorChart.balloon.bulletSize=5;
visitorChart.addListener("dataUpdated",visitorChartDataUpdated);var d=visitorChart.categoryAxis;d.parseDates=true;d.minPeriod="DD";d.axisAlpha=0;d.dashLength=1;
d.boldPeriodBeginning=false;d.position="bottom";d.axisColor="#dadada";var l=visitorChart.balloon;l.adjustBorderColor=true;l.color=b;l.cornerRadius=5;l.borderAlpha=1;
l.borderColor=b;l.borderThickness=1;l.fillColor=b;l.fillAlpha=0.8;l.color="#f3f3f3";l.showBullet=true;l.fontSize=15;l.textShadowColor="#666";var h=new AmCharts.ValueAxis();
h.axisAlpha=0;h.dashLength=1;h.minimum=0;visitorChart.addValueAxis(h);var g=new AmCharts.AmGraph();g.type="line";g.valueField="visits";g.bullet="round";
g.bulletColor="#ffffff";g.bulletBorderColor=b;g.bulletBorderThickness=2;g.bulletSize=6;g.fillColors=b;g.fillAlphas=0.2;g.lineThickness=2;g.lineColor=b;
g.balloonText="[[category]]: [[value]] visitors";visitorChart.addGraph(g);var j=new AmCharts.AmGraph();j.type="column";j.valueField="chats";j.fillColors=b;
j.fillAlphas=0.5;j.lineColor=b;j.lineThickness=1;j.balloonText="[[value]] chats";j.startDuration=1;visitorChart.addGraph(j);visitorChartCursor=new AmCharts.ChartCursor();
visitorChartCursor.cursorPosition="mouse";visitorChartCursor.pan=false;visitorChartCursor.zoomable=false;visitorChartCursor.categoryBalloonEnabled=false;
visitorChartCursor.cursorAlpha=0;visitorChartCursor.categoryBalloonDateFormat="EEE DD MMM YYYY";visitorChart.addChartCursor(visitorChartCursor);visitorChart.fontFamily="Segoe UI";
visitorChart.fontSize=14;visitorChart.color="#666";visitorChart.write("visitor-chart");if(visitorChartEmpty===true){$("#visitor-empty").fadeIn();}}var weekdayChart,weekdayChartData=[],weekdayChartCursor,weekdayChartEmpty=false;
function showWeekdayChart(){var a="#54c2ea";var b=1;if(weekdayChartData.length===0){weekdayChartData=[{Day:"Sunday",Total:3,Average:1.5},{Day:"Monday",Total:4,Average:2},{Day:"Tuesday",Total:1,Average:1},{Day:"Wednesday",Total:5,Average:2.5},{Day:"Thursday",Total:3,Average:3},{Day:"Friday",Total:5,Average:1.7},{Day:"Saturday",Total:0,Average:1.5}];
weekdayChartEmpty=true;}if(weekdayChartEmpty){a="#cccccc";b=0.4;}$("#weekday-chart").css("opacity",b);weekdayChart=new AmCharts.AmSerialChart();weekdayChart.dataProvider=weekdayChartData;
weekdayChart.categoryField="Day";weekdayChart.balloon.bulletSize=5;weekdayChart.startDuration=1;var e=weekdayChart.categoryAxis;e.parseDates=false;e.minPeriod="DD";
e.axisAlpha=0;e.dashLength=1;e.boldPeriodBeginning=false;e.position="bottom";e.axisColor="#dadada";var d=weekdayChart.balloon;d.adjustBorderColor=true;
d.color=a;d.cornerRadius=5;d.borderAlpha=1;d.borderColor=a;d.borderThickness=1;d.fillColor=a;d.fillAlpha=0.8;d.color="#f3f3f3";d.showBullet=true;d.bulletSize=4;
d.fontSize=15;d.textShadowColor="#666";var f=new AmCharts.ValueAxis();f.axisAlpha=0;f.dashLength=1;f.minimum=0;weekdayChart.addValueAxis(f);var c=new AmCharts.AmGraph();
c.type="column";c.valueField="Average";c.bulletSize=0;c.fillColors=a;c.fillAlphas=0.5;c.lineThickness=1;c.lineColor=a;c.balloonText="[[category]]: [[value]] chats (average)";
weekdayChart.addGraph(c);weekdayChartCursor=new AmCharts.ChartCursor();weekdayChartCursor.cursorPosition="mouse";weekdayChartCursor.pan=false;weekdayChartCursor.zoomable=false;
weekdayChartCursor.categoryBalloonEnabled=false;weekdayChartCursor.cursorAlpha=0;weekdayChartCursor.categoryBalloonDateFormat="EEE DD MMM YYYY";weekdayChart.addChartCursor(weekdayChartCursor);
weekdayChart.fontFamily="Segoe UI";weekdayChart.fontSize=14;weekdayChart.color="#666";weekdayChart.write("weekday-chart");if(weekdayChartEmpty===true){$("#weekday-empty").fadeIn();
}}var chatChart,chatChartData=[],chatChartCursor,chatChartEmpty=false;function showChatChart(){var b="#54c2ea";var e=1;if(chatChartData.length===0){for(var c=30;
c>0;c--){var a=new Date(),h=Math.floor(Math.random()*(80-30+1))+30;a.setDate(a.getDate()-c);chatChartData.push({date:a,chats:h});}chatChartEmpty=true;}if(chatChartEmpty){b="#cccccc";
e=0.4;}$("#chat-chart").css("opacity",e);chatChart=new AmCharts.AmSerialChart();chatChart.dataProvider=chatChartData;chatChart.categoryField="date";chatChart.balloon.bulletSize=5;
chatChart.startDuration=1;chatChart.addListener("dataUpdated",chatChartDataUpdated);var d=chatChart.categoryAxis;d.parseDates=true;d.minPeriod="DD";d.axisAlpha=0;
d.dashLength=1;d.boldPeriodBeginning=false;d.position="bottom";d.axisColor="#dadada";var j=chatChart.balloon;j.adjustBorderColor=true;j.color=b;j.cornerRadius=5;
j.borderAlpha=1;j.borderColor=b;j.borderThickness=1;j.fillColor=b;j.fillAlpha=0.8;j.color="#f3f3f3";j.showBullet=true;j.bulletSize=4;j.fontSize=15;j.textShadowColor="#666";
var g=new AmCharts.ValueAxis();g.axisAlpha=0;g.dashLength=1;g.minimum=0;chatChart.addValueAxis(g);var f=new AmCharts.AmGraph();f.type="column";f.valueField="chats";
f.bulletSize=0;f.fillColors=b;f.fillAlphas=0.5;f.lineThickness=1;f.lineColor=b;f.balloonText="[[category]]: [[value]] chats";chatChart.addGraph(f);chatChartCursor=new AmCharts.ChartCursor();
chatChartCursor.cursorPosition="mouse";chatChartCursor.pan=false;chatChartCursor.zoomable=false;chatChartCursor.categoryBalloonEnabled=false;chatChartCursor.cursorAlpha=0;
chatChartCursor.categoryBalloonDateFormat="EEE DD MMM YYYY";chatChart.addChartCursor(chatChartCursor);chatChart.fontFamily="Segoe UI";chatChart.fontSize=14;
chatChart.color="#666";chatChart.write("chat-chart");if(chatChartEmpty===true){$("#chat-empty").fadeIn();}}function pad(a){return a<10?"0"+a:a;}function getUTCOffset(){var c=new Date();
var b=(c.getTimezoneOffset()>0)?"-":"+";var e=Math.abs(c.getTimezoneOffset());var a=pad(Math.floor(e/60));var d=pad(e%60);return b+a+d;}function loadStatisticsChartData(){if(session.length>0){var a=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Statistics":service+"?Statistics",b={Session:session,Timezone:getUTCOffset(),Version:"4.0",Format:"json"};
$.ajax({url:a,data:b,type:"POST",success:function(l){if(l.Statistics!==null&&l.Statistics!==undefined){var m=0,r=l.Statistics.Chats,d=l.Statistics.Visitors,j=l.Statistics.Duration,k=l.Statistics.Rating,c,q;
if(d!==null&&d!==undefined){c=new moment(d.Date).add("d",1).toDate();if(d!==null&&r!==null&&r.Data!==undefined){d.Data=d.Data.reverse();visitorChartData=[];
for(m=0;m<30;m++){visitorChartData.push({date:new moment(c).add("day",m).toDate(),chats:r.Data[m],visits:d.Data[m]});visitorChartEmpty=false;}}}showVisitorChart();
if(r!==null&&r!==undefined&&r.Data!==undefined){var h=0.5;c=new moment(r.Date).add("day",1).toDate();historyChartData=[];chatChartData=[];for(m=0;m<30;
m++){if(m>23){historyChartData.push({date:new moment(c).add("day",m).toDate(),chats:r.Data[m]});}if(m>28){color="#00637d";h=0.8;}else{color="#54c2ea";h=0.5;
}chatChartData.push({date:new moment(c).add("day",m).toDate(),color:color,alpha:h,chats:r.Data[m]});chatChartEmpty=false;}weekdayChartData=r.Weekday;}showChatChart();
showHistoryChart();showWeekdayChart();var n=0;if(j!==null&&j!==undefined&&j.Data!==undefined){$.each(j.Data,function(s,t){n+=t;});var f=parseInt(n/j.Data.length,10);
var o=Math.floor(f/3600);var g=Math.floor((f-(o*3600))/60);var p=f-(o*3600)-(g*60)+" seconds";o=(o>0)?o+" hours ":"";g=g+" minutes ";f=o+g+p;$(".statistics .averagechattime").text(f);
}else{$(".statistics .averagechattime").text(locale.unavailable);}n=0;if(k!==null&&k!==undefined){ratingChartData=[{rating:"Excellent",total:parseInt(k.Excellent,10)},{rating:"Very Good",total:parseInt(k.VeryGood,10)},{rating:"Good",total:parseInt(k.Good,10)},{rating:"Poor",total:parseInt(k.Poor,10)},{rating:"Very Poor",total:parseInt(k.VeryPoor,10)},{rating:"Unrated",total:parseInt(k.Unrated,10)}];
ratingChartEmpty=false;var e=0;k=5;$.each(ratingChartData,function(s,t){if(t.total>0&&s<5){n+=t.total;e+=(k-s)*t.total;k--;}});if(n>0){e=(e/n).toFixed(2);
k=ratingChartData[5-parseInt(e,10)].rating;$(".statistics .averagechatrating").text(e+" "+k);}else{$(".statistics .averagechatrating").text(locale.unavailable);
}}else{$(".statistics .averagechatrating").text(locale.unavailable);}showRatingChart();}},dataType:"json"});}}function visitorChartDataUpdated(){if(!visitorChartEmpty){$("#visitor-chart").fadeTo(1000,1);
}}function chatChartDataUpdated(){if(!chatChartEmpty){$("#chat-chart").fadeTo(1000,1);}}var ratingChart,ratingChartData=[],ratingChartCursor,ratingChartEmpty=false;
function showRatingChart(){var d=false,a=["#54c2ea","#235A78","#439494","#4DAAAB","#B4DCED","#1A8BB2"],e=0.8,b="#54c2ea";if(ratingChartData.length===0){ratingChartData=[{rating:"Excellent",total:20},{rating:"Very Good",total:18},{rating:"Good",total:10},{rating:"Poor",total:4},{rating:"Very Poor",total:2},{rating:"Unrated",total:8}];
ratingChartEmpty=true;}if(ratingChartEmpty){a=["#2F3540","#666A73","#F2EDE4","#D9D1C7","#8C8681","#333333"];e=0.1;b="#CCC";}var g=$(".rating.histogram"),f=0,c=0,h=[".excellent",".verygood",".good",".poor",".verypoor",".unrated"];
$.each(ratingChartData,function(k,l){f+=parseInt(l.total,10);});c=250/f;$.each(h,function(k,l){g.find(l).css({background:b}).animate({width:ratingChartData[k].total*c},1000,"easeInOutBack");
});ratingChart=new AmCharts.AmPieChart();ratingChart.dataProvider=ratingChartData;ratingChart.titleField="rating";ratingChart.valueField="total";ratingChart.outlineColor="#eeedee";
ratingChart.outlineAlpha=1;ratingChart.outlineThickness=2;ratingChart.radius="30%";ratingChart.colors=a;ratingChart.pieAlpha=e;ratingChart.pullOutOnlyOne=true;
var j=ratingChart.balloon;j.adjustBorderColor=true;j.cornerRadius=5;j.borderAlpha=1;j.borderColor="#54c2ea";j.borderThickness=1;j.fillColor="[[color]]";
j.fillAlpha=e;j.color="#f3f3f3";j.showBullet=true;j.fontSize=15;j.textShadowColor="#666";ratingChart.write("rating-chart");if(ratingChartEmpty){$("#rating-empty").fadeIn();
}}var historyChart,historyChartData=[],historyChartCursor;function showHistoryChart(){var e=false;if(historyChartData.length===0){for(var b=7;b>0;b--){var a=new Date(),h=Math.floor(Math.random()*(20-5+1))+5;
a.setDate(a.getDate()-b);historyChartData.push({date:a,chats:h});}e=true;}historyChart=new AmCharts.AmSerialChart();historyChart.dataProvider=historyChartData;
historyChart.categoryField="date";historyChart.balloon.bulletSize=5;historyChart.addListener("dataUpdated",historyChartDataUpdated);var f=historyChart.categoryAxis;
f.parseDates=true;f.minPeriod="DD";f.axisAlpha=0;f.dashLength=0;f.boldPeriodBeginning=false;f.position="top";f.axisColor="#dadada";f.labelsEnabled=false;
f.gridAlpha=0;var d=historyChart.balloon;d.adjustBorderColor=true;d.color="#999999";d.cornerRadius=5;d.borderAlpha=1;d.borderColor="#999999";d.borderThickness=1;
d.fillColor="#999999";d.fillAlpha=0.8;d.color="#f3f3f3";d.showBullet=true;d.fontSize=15;d.textShadowColor="#666";var g=new AmCharts.ValueAxis();g.axisAlpha=0;
g.dashLength=0;g.labelsEnabled=false;g.minimum=0;g.gridAlpha=0.1;historyChart.addValueAxis(g);var c=new AmCharts.AmGraph();c.type="line";c.valueField="chats";
c.bullet="round";c.bulletColor="#ffffff";c.bulletBorderColor="#999999";c.bulletBorderThickness=2;c.bulletSize=6;c.fillColors="#999999";c.fillAlphas=0.2;
c.lineThickness=2;c.lineColor="#999999";c.balloonText="[[category]]: [[value]] chats";historyChart.addGraph(c);historyChartCursor=new AmCharts.ChartCursor();
historyChartCursor.cursorPosition="mouse";historyChartCursor.pan=false;historyChartCursor.zoomable=false;historyChartCursor.categoryBalloonEnabled=false;
historyChartCursor.cursorAlpha=0;historyChartCursor.categoryBalloonDateFormat="EEE DD MMM YYYY";historyChart.addChartCursor(historyChartCursor);historyChart.fontFamily="Segoe UI";
historyChart.fontSize=14;historyChart.color="#666";historyChart.write("history-chart");if(e){$("#history-empty").fadeIn();}}function historyChartDataUpdated(){$("#history-chart").fadeTo(1000,1);
}function ucwords(a){return(a+"").replace(/^([a-z])|\s+([a-z])/g,function(b){return b.toUpperCase();});}function strtolower(a){return(a+"").toLowerCase();
}function htmlSmilies(d){var c=[{regex:/:D/g,css:"Laugh"},{regex:/:\)/g,css:"Smile"},{regex:/:\(/g,css:"Sad"},{regex:/\$\)/g,css:"Money"},{regex:/&gt;:O/g,css:"Angry"},{regex:/:P/g,css:"Impish"},{regex:/:\\/g,css:"Sweat"},{regex:/8\)/g,css:"Cool"},{regex:/&gt;:L/g,css:"Frown"},{regex:/;\)/g,css:"Wink"},{regex:/:O/g,css:"Surprise"},{regex:/8-\)/g,css:"Woo"},{regex:/8-O/g,css:"Shock"},{regex:/xD/g,css:"Hysterical"},{regex:/:-\*/g,css:"Kissed"},{regex:/:S/g,css:"Dizzy"},{regex:/\+O\)/g,css:"Celebrate"},{regex:/&lt;3/g,css:"Adore"},{regex:/zzZ/g,css:"Sleep"},{regex:/:X/g,css:"Stop"},{regex:/X-\(/g,css:"Tired"}];
for(var b=0;b<c.length;b++){var a=c[b];d=d.replace(a.regex,'<span title="'+a.css+'" class="sprite '+a.css+' Smilie"></span>');}return d;}function openHome(){$(".history, .statistics").fadeOut();
if(visitors!==undefined&&visitors.length>0&&$(".worldmap").css("display")=="none"){$(".visitors-empty").hide();$(".visitors-grid, .visitors-menu").fadeIn();
$(".visitors-list.button").css({background:"url(./images/ListHover.png) no-repeat",opacity:1});$(".visitors-map.button").css({background:"url(./images/World.png) no-repeat",opacity:0.2});
}}var locale=$.jStorage.get("locale",{});function processLanguage(b){locale=b;var a=$("[data-lang-key]");$.each(a,function(d,c){var c=$(c),d=c.attr("data-lang-key");
c.text(b[d]);});$.jStorage.set("locale",locale);}function updateLanguage(a){$.ajax({url:"../locale/"+a+"/admin.json",type:"GET",success:function(b){if(b!==undefined){processLanguage(b);
}},error:function(b,d,c){},dataType:"json"});}function loadSettings(c){settings=c;$("#domainname").val(c.Domain);$("#siteaddress").val(c.SiteAddress);$("#livehelpname").val(c.Name);
if(c.VisitorTracking!==0){$("#visitortracking-enable").attr("checked","checked");}else{$("#visitortracking-disable").attr("checked","checked");}if(c.Departments!==0){$("#departments-enable").attr("checked","checked");
}else{$("#departments-disable").attr("checked","checked");}$("#welcomenote").val(c.WelcomeMessage);$("#language").empty();var d=c.Language.Available.split(", ");
var a=[{code:"af",name:"Afrikaans"},{code:"ar",name:"Arabic"},{code:"be",name:"Byelorussian"},{code:"bg",name:"Bulgarian"},{code:"ca",name:"Catalan"},{code:"zh",name:"Chinese Simplified"},{code:"cs",name:"Czech"},{code:"da",name:"Danish"},{code:"de",name:"German"},{code:"el",name:"Greek"},{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"et",name:"Estonian"},{code:"eu",name:"Basque"},{code:"fi",name:"Finnish"},{code:"fo",name:"Faroese"},{code:"fr",name:"French"},{code:"ga",name:"Irish"},{code:"gl",name:"Galician"},{code:"hr",name:"Croatian"},{code:"hu",name:"Hungarian"},{code:"is",name:"Icelandic"},{code:"it",name:"Italian"},{code:"he",name:"Hebrew"},{code:"ja",name:"Japanese"},{code:"ko",name:"Korean"},{code:"lt",name:"Lithuanian"},{code:"lv",name:"Latvian"},{code:"mk",name:"Macedonian"},{code:"mt",name:"Maltese"},{code:"nl",name:"Dutch"},{code:"no",name:"Norwegian"},{code:"pl",name:"Polish"},{code:"pt",name:"Portuguese"},{code:"ro",name:"Romanian"},{code:"ru",name:"Russian"},{code:"sk",name:"Slovak"},{code:"sl",name:"Slovenian"},{code:"sq",name:"Albanian"},{code:"sv",name:"Swedish"},{code:"tr",name:"Turkish"},{code:"uk",name:"Ukrainian"}];
$.each(d,function(f,g){var e="";$.each(a,function(h,j){if(g==j.code){e=j.name;return false;}});$('<option value="'+g+'">'+e+"</option>").appendTo("#language");
});$("#language").val(c.Language.Locale);updateLanguage(c.Language.Locale);$("#template").find("option").remove();$.each(c.Templates,function(e,f){$("#template").append('<option value="'+f.value+'">'+f.name+"</option>");
});if(c.Smilies!==0){$("#smilies-enable").attr("checked","checked");enableSmilies();}else{$("#smilies-disable").attr("checked","checked");disableSmilies();
}$("#backgroundcolor").val(c.BackgroundColor);$("#generalfont").val(c.Font.Type);$("#generalfontsize").val(c.Font.Size);$("#generalfontcolor").val(c.Font.Color);
$("#generalfontlinkcolor").val(c.Font.LinkColor);$("#guestchatfont").val(c.ChatFont.Type);$("#guestchatfontsize").val(c.ChatFont.Size);$("#sentcolor").val(c.ChatFont.SentColor);
$("#receivedcolor").val(c.ChatFont.ReceivedColor);$("#chatwindowsize").val(c.ChatWindowSize.Width+" x "+c.ChatWindowSize.Height);$("input#backgroundcolor, input#sentcolor, input#receivedcolor, input#generalfontcolor, input#generalfontlinkcolor").miniColors();
if(window.webkitNotifications){$("#html5-notifications-enable").attr("checked","checked");if($.jStorage.get("html5-notifications",true)){checkHTML5NotificationsPermission();
}else{$("#html5-notifications-disable").attr("checked","checked");}}else{$("#html5-notifications-disable").attr("checked","checked");$(".html5-notifications input").attr("disabled","disabled");
$.jStorage.set("html5-notifications",false);}$("#logo").val(c.Logo);$("#campaignimage").val(c.Campaign.Image);$("#campaignlink").val(c.Campaign.Link);$("#onlineimage").val(c.OnlineLogo);
$("#offlineimage").val(c.OfflineLogo);$("#berightbackimage").val(c.BeRightBackLogo);$("#awayimage").val(c.AwayLogo);$("#htmlcodestep1").val(c.Code.Head);
$("#htmlcodestep2").val(c.Code.Image);$("#emailaddress").val(c.Email);$("#offlineurlredirection").val(c.OfflineEmail.Redirect);if(c.OfflineEmail.Enabled!==0){$("#email-enable").attr("checked","checked");
}else{$("#email-disable").attr("checked","checked");}$("#autoinitiatechat-enable").click(function(){if($(this).is(":checked")){$(".autoinitiate-pageviews").fadeIn();
}});$("#autoinitiatechat-disable").click(function(){if($(this).is(":checked")){$(".autoinitiate-pageviews").fadeOut();}});if(c.InitiateChat.Auto>0){$("#autoinitiatechat-enable").attr("checked","checked");
$("#autoinitiatechat-pages").val(c.InitiateChat.Auto);$(".autoinitiate-pageviews").fadeIn();}else{$("#autoinitiatechat-disable").attr("checked","checked");
$("#autoinitiatechat-pages").val(c.InitiateChat.Auto);$(".autoinitiate-pageviews").hide();}$("#verticalalignment").val(c.InitiateChat.Vertical);$("#horizontalalignment").val(c.InitiateChat.Horizontal);
if(c.ChatUsername!==0){$("#displaychatusername-enable").attr("checked","checked");}else{$("#displaychatusername-disable").attr("checked","checked");}if(c.LoginDetails.Required!==0){$("#guestlogindetails-required").attr("checked","checked");
}else{if(c.LoginDetails.Enabled!==0){$("#guestlogindetails-optional").attr("checked","checked");}else{$("#guestlogindetails-disable").attr("checked","checked");
}}if(c.LoginDetails.Email!==0){$("#guestemailaddress-enable").attr("checked","checked");}else{$("#guestemailaddress-disable").attr("checked","checked");
}if(c.LoginDetails.Question!==0){$("#guestquestion-enable").attr("checked","checked");}else{$("#guestquestion-disable").attr("checked","checked");}if(c.SecurityCode!==0){$("#securitycode-enable").attr("checked","checked");
}else{$("#securitycode-disable").attr("checked","checked");}$("#p3p").val(c.P3P);if(c.Version!==undefined){var b=c.Version.Server;if(b>=4.1){$(".visitors-list.button, .visitors-map.button").css("display","inline-block");
}}$(document).trigger("LiveHelp.SettingsLoaded",settings);}function enableSmilies(){$(".smilies.button").show();}function disableSmilies(){$(".smilies.button").hide();
}function checkHTML5NotificationsPermission(){switch(window.webkitNotifications.checkPermission()){case 0:$(".html5-notifications input").removeAttr("disabled");
$.jStorage.set("html5-notifications",true);break;case 2:$(".html5-notifications input").attr("disabled","disabled");$.jStorage.set("html5-notifications",false);
break;}}function openSettings(){var c=$(".settings"),e=$(".settingsmenu");if(c.is(":hidden")){var d=$(".settingsmenu > div:not(#htmlcode, #alerts, .backLava)");
if(operator.access>=2){d.remove();e.find("#alerts").click();}c.show();$(".general").mouseover();$(".settings").animate({height:600,opacity:1},250,"easeInOutBack",function(){$(this).find(".button-toolbar").animate({bottom:"15px"},250,"easeInOutBack");
});if(e.find(".backLava").length===0){e.lavaLamp({target:"div",container:"div",speed:250,includeMargins:true,easing:"easeOutBack",fx:"easeOutBack"});}var a=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Settings":service+"?Settings",b={Session:session,Version:"4.0",Format:"json"};
$.ajax({url:a,data:b,type:"POST",success:function(f){if(f.Settings!==undefined){loadSettings(f.Settings);}},dataType:"json"});$(".html5-notifications input").click(function(){if(window.webkitNotifications){if($("#html5-notifications-enable").is(":checked")){window.webkitNotifications.requestPermission(checkHTML5NotificationsPermission);
}else{$.jStorage.set("html5-notifications",false);}}else{$(".html5-notifications input").attr("disabled","disabled");$.jStorage.set("html5-notifications",false);
}});}}function saveSettings(){if(operator.access>=2){return;}var c=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Settings":service+"?Settings",e=($("#settings #smilies-enable").is(":checked"))?-1:0,p=($("#settings #visitortracking-enable").is(":checked"))?-1:0,m=($("#settings #departments-enable").is(":checked"))?-1:0,q=($("#settings #email-enable").is(":checked"))?-1:0,f=($("#settings #guestemailaddress-enable").is(":checked"))?-1:0,b=($("#settings #guestquestion-enable").is(":checked"))?-1:0,n=($("#settings #autoinitiatechat-disable:checked").length>0)?-1:$("#settings #autoinitiatechat-pages").val(),a=($("#settings #displaychatusername-enable").is(":checked"))?-1:0,g=($("#settings #securitycode-enable").is(":checked"))?-1:0,k=($("#settings #guestlogindetails-disable").is(":checked"))?0:-1,l=($("#settings #guestlogindetails-required").is(":checked"))?-1:0,j=$("#settings select#chatwindowsize").val(),h={width:parseInt(j.substring(0,j.indexOf(" x ")),10),height:parseInt(j.substring(j.indexOf(" x ")+3),10)},d={Session:session,Domain:$("#settings #domainname").val(),URL:$("#settings #siteaddress").val(),Email:$("#settings #emailaddress").val(),Name:$("#settings #livehelpname").val(),Logo:$("#settings #logo").val(),Introduction:$("#settings #welcomenote").val(),Smilies:e,Font:$("#settings #generalfont").val(),FontSize:$("#settings #generalfontsize").val(),FontColor:$("#settings #generalfontcolor").val(),ChatFont:$("#settings #guestchatfont").val(),SentFontColor:$("#settings #sentcolor").val(),ReceivedFontColor:$("#settings #receivedcolor").val(),LinkColor:$("#settings #generalfontlinkcolor").val(),BackgroundColor:$("#settings #backgroundcolor").val(),ChatFontSize:$("#settings #guestchatfontsize").val(),OfflineLogo:$("#settings #offlineimage").val(),OnlineLogo:$("#settings #onlineimage").val(),OfflineEmailLogo:$("#settings #offlineimage").val(),BeRightBackLogo:$("#settings #berightbackimage").val(),AwayLogo:$("#settings #awayimage").val(),LoginDetails:k,LoginEmail:f,LoginQuestion:b,OfflineEmail:q,OfflineEmailRedirect:$("#settings #offlineurlredirection").val(),SecurityCode:g,Departments:m,VisitorTracking:p,Locale:$("#settings #language").val(),InitiateChatVertical:$("#settings #verticalalignment").val(),InitiateChatHorizontal:$("#settings #horizontalalignment").val(),InitiateChatAuto:n,ChatUsername:a,CampaignImage:$("#settings #campaignimage").val(),CampaignLink:$("#settings #campaignlink").val(),IP2Country:-1,P3P:$("#settings #p3p").val(),ChatWindowWidth:h.width,ChatWindowHeight:h.height,RequireGuestDetails:l,Template:$("#settings #template").val(),Format:"json",Version:"4.0"};
var o=$(".settings-dialog");o.find(".progressring").show();o.find(".dialog-title").text("Saving Settings");o.find(".dialog-description").text("One moment while your settings are saved.");
o.animate({bottom:0},250,"easeInOutBack");$.ajax({url:c,data:d,type:"POST",success:function(r){if(r.Settings!==undefined){loadSettings(r.Settings);o.find(".progressring").hide();
o.find(".dialog-title").text("Settings Saved Successfully");o.find(".dialog-description").text("Your settings were saved successfully.");}o.delay(1000).animate({bottom:-90},250,"easeInOutBack");
},error:function(r,t,s){o.find(".progressring").hide();o.find(".dialog-title").text("Error Saving Settings");o.find(".dialog-description").text("An error occurred while saving the settings.  Please contact technical support.");
o.delay(3000).animate({bottom:-90},250,"easeInOutBack");},dataType:"json"});}function closeSettings(){$(".miniColors-selector").hide();$(".settings").animate({height:0,opacity:0},250,"easeInOutBack",function(){$(this).hide();
$(this).find(".button-toolbar").animate({bottom:"-90px"},250,"easeInOutBack");});switchPreviousMenu();}function zeroFill(b,a){a-=b.toString().length;if(a>0){return new Array(a+(/\./.test(b)?2:1)).join("0")+b;
}return b;}function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1);}function openHistoryChat(e){var g=$("#history-chat"),b=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Chats":service+"?Chats",a=parseInt(e.Session,10),f=parseInt(e.Active,10),d="Session="+session+"&Data="+a+",0,0,0&Version=4.0&Format=json";
if(a>0){g.data("id",a);g.find(".name").text(e.Username+" - "+$(e.Email).text());g.find(".messages").html("");var c=g.find(".dialog");if(f===-3){c.show().animate({bottom:"1px"},250);
}else{c.hide().animate({bottom:"-145px"},250);}$.ajax({url:b,data:d,type:"POST",success:function(k){if(k.MultipleMessages!==undefined&&k.MultipleMessages.Messages!==undefined){var j=k.MultipleMessages.Messages[0],h="",l="left";
if(parseInt(j.ID,10)===a&&j.Message.length>0){$.each(j.Message,function(v,u){var q=parseInt(u.Status,10),x=u.Content,o=new moment(u.Datetime,"YYYY-MM-DD HH:mm:ss").toDate(),n=o.getHours()+":"+zeroFill(o.getMinutes(),2);
if(q>0){x=$("<div>").text(x).html();}if(q===3){var w=/(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)/im;
var t=w.exec(x);if(t!==null){x='<img src="'+t[0]+'" />';}}else{x=x.replace(/(?!.*(?:\.jpe?g|\.gif|\.png)$)((?:(?:http(?:s?))|(?:ftp)):\/\/[^\s|<|>|'|"]*)/img,'<a href="$1" target="_blank">$1</a>');
x=x.replace(/^(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)$/img,'<img src="$&"/>');}if(settings.Smilies!==0){x=htmlSmilies(x);
}var s=u.Username;if(q===1){$.each(accounts.Operator,function(y,z){if(z.Username===s){s=z.Firstname;return;}});}s=(s.length>0)?"from "+capitaliseFirstLetter(s):"";
l=(q>0)?"right":"left";if(q===0){h+='<blockquote class="message '+l+'"><div style="margin-bottom: 3px">'+x+'</div><div style="bottom:5px; right:5px; font-size:11px; float:right">'+s+" at "+n+"</div></blockquote>";
}else{if(q>=0){h+='<blockquote class="message '+l+'"><div style="margin-bottom: 3px">'+x+'</div><div style="bottom:5px; right:5px; font-size:11px; float:right">'+s+" at "+n+"</div></blockquote>";
}else{if(q===-2){h+='<div style="color:#666; font-size:12px; margin-left:20px; line-height:20px"><img src="http://'+server+'/image.php?SIZE=20" style="float:left; margin-right:5px"/>'+capitaliseFirstLetter(x)+"</div>";
}else{if(q===-3){var p=parseInt(x.substring(x.length-1),10),m="";for(var r=1;r<=5;r++){if(p>=r){m+='<div class="rating-highlight"></div>';}else{m+='<div class="rating"></div>';
}}x=x.substring(0,x.length-2);switch(p){case 5:p="Excellent";break;case 4:p="Very Good";break;case 3:p="Good";break;case 2:p="Poor";break;case 1:p="Very Poor";
break;}h+='<div style="margin-left:20px">'+x+"<span>"+m+'<span style="margin-left:10px">'+p+"</span></span></div>";}}}}});$(h).appendTo("#history-chat .messages");
}}},dataType:"json"});g.show();g.animate({width:"40%",opacity:1},250);}}function closeHistory(){var b=$("#history-chat"),a=b.width();b.animate({width:0,opacity:0},250,function(){b.hide();
});historyGrid.setSelectedRows([]);historyGrid.resetActiveCell();}var historyGrid,historyColumns,historyDataView,historyOptions={rowHeight:220,enableCellNavigation:true,enableColumnReorder:false,multiColumnSort:true,multiSelect:false};
function updateHistoryFilter(){historyDataView.setFilterArgs({searchString:historySearch});historyDataView.refresh();}function initHistoryGridEvents(){if(historyGrid===undefined){var a=new Slick.Data.GroupItemMetadataProvider();
historyDataView=new Slick.Data.DataView({groupItemMetadataProvider:a});if(historyGrid!==undefined){historyColumns=historyGrid.getColumns();}else{historyColumns=$.jStorage.get("historyColumns",[{id:"history",name:"Chat History",field:"Username",headerCssClass:"username-column-header",width:550,formatter:renderHistoryCell,sortable:true,resizable:true},{id:"date",name:"Date",field:"Date",width:150,formatter:Slick.Formatters.Date,sortable:true,resizable:true}]);
historyColumns[0].formatter=renderHistoryCell;historyColumns[1].formatter=Slick.Formatters.Date;}historyGrid=new Slick.Grid(".history-grid",historyDataView,historyColumns,historyOptions);
historyGrid.registerPlugin(a);historyGrid.setSelectionModel(new Slick.RowSelectionModel());historyGrid.onColumnsResized.subscribe(function(){$.jStorage.set("historyColumns",historyGrid.getColumns());
});historyGrid.onSelectedRowsChanged.subscribe(function(){rows=historyGrid.getSelectedRows();chat=historyDataView.getItem(rows);if(chat!==undefined){openHistoryChat(chat);
}});historyGrid.onSort.subscribe(function(d,b){var c=b.sortCols;historyDataView.sort(function(n,m){for(var g=0,f=c.length;g<f;g++){var k=c[g].sortCol.field;
var e=c[g].sortAsc?1:-1;var j=n[k],h=m[k];var o=(j==h?0:(j>h?1:-1))*e;if(o!==0){return o;}}return 0;});historyGrid.invalidate();historyGrid.render();});
historyDataView.onRowCountChanged.subscribe(function(c,b){historyGrid.updateRowCount();historyGrid.render();});historyDataView.onRowsChanged.subscribe(function(c,b){historyGrid.invalidateRows(b.rows);
historyGrid.render();});}}function renderHistoryCell(r,p,m,k,a){var h="Chrome",b="",n=a.Country;m=a.UserAgent;if(m.indexOf("MSIE")!==-1){h="InternetExplorer";
}else{if(m.indexOf("Chrome")!==-1){h="Chrome";}else{if(m.indexOf("Opera")!==-1){h="Opera";}else{if(m.indexOf("Safari")!==-1){h="Safari";}else{if(m.indexOf("Firefox")!==-1){h="Firefox";
}}}}}a.Username=ucwords(a.Username.toLowerCase());a.UserAgent="./images/"+h+".png";if(a.State!==null&&a.State.length>0){if(a.City!==null&&a.City.length>0){n=a.City+", "+a.State+", "+a.Country;
}else{n=a.State+", "+a.Country;}}else{if(a.City!==null&&a.City.length>0){n=a.City+", "+a.Country;}}b='<span class="'+convertCountryIcon(a.Country)+'" style="float:left; margin: 3px 5px 3px 0; display:inline-block"></span>';
a.Location=b+n;if(a.Department.length===0){a.Department="Unavailable";}if(a.Email.length>0){if(a.Email.indexOf("mailto:")===-1&&a.Email.length>0){a.Email='<a href="mailto:'+a.Email+'">'+a.Email+"</a>";
}}else{a.Email="Unavailable";}if(a.CurrentPage.indexOf("href")===-1&&a.CurrentPage.length>0){a.CurrentPage='<a href="'+a.CurrentPage+'" target="_blank">'+a.CurrentPage+"</a>";
}var l=a.Referrer,q=/^http[s]{0,1}:\/\/(?:[^.]+[\\.])*google(?:(?:.[a-z]{2,3}){1,2})[\/](?:search|url|imgres|aclk)(?:\?|.*&)q=([^&]*)/i,g=q.exec(l);if(g!==null){if(g[1].length>0){l="Google Search (Keywords: "+g[1]+")";
}else{l="Google Search";}}a.Referrer=l;var c=parseInt(a.Rating,10),o="No Rating",f="";switch(c){case 1:o="Very Poor";break;case 2:o="Poor";break;case 3:o="Good";
break;case 4:o="Very Good";break;case 5:o="Excellent";break;}for(var e=1;e<=5;e++){var j="",d="";if(c>=e){j="-highlight";}if(c===0){d=" rating-disabled";
}f+='<div class="rating'+j+d+'"></div>';}f+='<span style="margin-left:5px">'+o+"</span>";var p='<div class="cell-inner"> 	<div class="cell-left"> 		<img src="'+a.UserAgent+'"/> 	</div> 	<div class="cell-main"> 	  <h2 style="text-transform: none">'+a.Username+"</h2> 	  <span>"+a.Operator+"</span><br/> 	  <span>"+a.Department+"</span><br/> 	  <span>"+a.Hostname+"</span><br/> 	  <span>"+a.Email+"</span><br/> 	  <span>"+a.Referrer+"</span><br/> 	  <span>"+a.CurrentPage+"</span><br/> 	  <span>"+a.Location+"</span><br/> 	  <span>"+f+"</span><br/> 	</div> </div>";
return p;}function initHistoryGrid(b){var e,f="";if(b===undefined){b=$.jStorage.get("history-date","");var d=$(".history #calendar");d.find("td").removeClass("selected-date");
d.find('td[id="'+b+'"]').addClass("selected-date");b=(b.length>0)?new moment(b,"YYYY-MM-DD HH:mm:ss"):new moment();b=b.year()+"-"+zeroFill(b.month()+1,2)+"-"+zeroFill(b.date(),2);
}function g(k,h){var j=h.searchString.toLowerCase();if(j!==""&&k.Username.toLowerCase().indexOf(j)==-1&&k.Email.toLowerCase().indexOf(j)==-1&&k.Department.toLowerCase().indexOf(j)==-1&&k.Operator.toLowerCase().indexOf(j)==-1&&k.Hostname.toLowerCase().indexOf(j)==-1){return false;
}return true;}if(session.length>0){var a=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?History":service+"?History",c="Session="+session+"&StartDate="+b+"&EndDate="+b+"&Timezone="+getUTCOffset()+"&Transcripts=1&ID=0&Version=4.0&Format=json";
initHistoryGridEvents();$.ajax({url:a,data:c,type:"POST",success:function(j){if(j.ChatHistory!==undefined){e=[];$.each(j.ChatHistory,function(l,m){e.push(m.Visitor);
});e=e.reverse();historyDataView.beginUpdate();historyDataView.setItems(e,"Session");historyDataView.setFilterArgs({searchString:f});historyDataView.setFilter(g);
historyDataView.endUpdate();var k="",h=e.length;if(h>1){k=" - "+e.length+" chats";}else{if(h>0){k=" - "+e.length+" chat";}}if(h>0){$(".history-empty").hide();
$(".history-grid").show();}else{$(".history-empty, .history-grid").show();}$(".username-column-header .slick-column-name").text("Chat History"+k);}},dataType:"json"});
}}function sliderIndex(){var b=$(".slider.right"),a=0;if(b.length>0){$.each(b,function(e,f){var d=$(f),c=parseInt(d.css("z-index"),10);if(d.width()>0&&c>a){a=c;
}});}return a;}function openResponses(b){var a=$("#responses");a.show();a.css("z-index",sliderIndex()+100);a.animate({width:"40%",opacity:1},250,function(){if(b){b();
}});}function closeResponses(){var b=$("#responses"),a=b.width();b.find(".search input").val("");filterResponses();b.animate({width:0,opacity:0},250,function(){b.hide();
});switchPreviousMenu();}var accountsLoaded=false;function lastUpdatedAccount(a){var b=null;$.each(a,function(d,e){var c=new moment(e.Updated,"YYYY-MM-DD HH:mm:ss").toDate();
if(!b||c>b){b=c;}});return b;}function showAccountsGrid(d,c){var f=$.jStorage.get("accounts",[]),b=lastUpdatedAccount(f);c=(c!==undefined)?c:false;$.jStorage.set("accounts",d);
$(document).trigger("LiveHelp.AccountsUpdated",[d]);var a=false;$.each(f,function(h,k){var g=parseInt(k.ID,10),j=false;$.each(d,function(m,n){var l=parseInt(n.ID,10);
if(g===l){j=true;}});if(!j){a=true;}});var e=lastUpdatedAccount(d);if(e>b||a||f.length!=d.length){updateAccountsGrid(d,c);}else{updateAccountsGrid(d,true);
$(document).trigger("LiveHelp.AccountsCompleted");}}var accountsGrid,accountsDataView,accounts,accountsColumns=[{id:"account",name:"",field:"Username",formatter:renderAccountCell,sortable:true}],accountsOptions={rowHeight:80,enableCellNavigation:true,enableColumnReorder:false,forceFitColumns:true,multiColumnSort:true,multiSelect:false},accountTemplate=null;
function renderAccountCell(j,g,f,e,a){var d=a,c=parseInt(d.Status,10);if(!isNaN(c)){switch(c){case 0:c="Offline";break;case 1:c="Online";break;case 2:c="Be Right Back";
break;case 3:c="Away";break;}d.Status=c;}d.Mobile="none";if(d.Device.length>0){d.Mobile="inline-block";}var b=(d.Disabled!=="none"&&d.Disabled!=="0")?true:false;
if(b&&d.Device.length===0){d.Disabled="inline-block; background:url('images/Lock.png') no-repeat; ";}else{d.Disabled="none";}var h=(window.devicePixelRatio>1)?200:100;
d.Image=protocol+server+"/livehelp/image.php?ID="+d.ID+"&SIZE="+h;var g='<div class="cell-inner" data-id="'+d.ID+'"> 	<div class="cell-left"> 		<div class="image" style="background: url('+d.Image+') no-repeat; background-size: 60px auto; width: 60px; height: 60px"></div> 	</div> 	<div class="cell-main"> 		<div class="cell-heading name">'+d.Firstname+" "+d.Lastname+'</div> 		<span class="cell-details department">'+d.Department+'</span> 		<span class="cell-details status">'+d.Status+'</span> 		<span class="disabled" title="Account Disabled" style="width:22px; height:22px; display:inline-block; position:absolute; bottom:10px; right:30px; opacity:0.3; display:'+d.Disabled+'"></span> 		<span class="sprite Smartphone" title="Logged in with Mobile App" style="position:absolute; bottom:10px; right:25px; opacity:0.5; display:'+d.Mobile+'"></span> 	</div> </div>';
return g;}function initAccountsGridEvents(){if(accountsGrid===undefined){var a=new Slick.Data.GroupItemMetadataProvider();accountsDataView=new Slick.Data.DataView({groupItemMetadataProvider:a});
accountsGrid=new Slick.Grid(".accounts-grid",accountsDataView,accountsColumns,accountsOptions);accountsGrid.registerPlugin(a);accountsGrid.setSelectionModel(new Slick.RowSelectionModel());
accountsGrid.onSelectedRowsChanged.subscribe(function(){rows=accountsGrid.getSelectedRows();account=accountsDataView.getItem(rows);if(account!==undefined){var b=$.jStorage.get("accounts",[]);
$.each(b,function(c,d){if(parseInt(account.ID,10)===parseInt(d.ID,10)){account=d;}});showAccount(account);accountsGrid.setSelectedRows([]);accountsGrid.resetActiveCell();
}});accountsGrid.onSort.subscribe(function(d,b){var c=b.sortCols;accountsDataView.sort(function(n,m){for(var g=0,f=c.length;g<f;g++){var k=c[g].sortCol.field;
var e=c[g].sortAsc?1:-1;var j=n[k],h=m[k];var o=(j==h?0:(j>h?1:-1))*e;if(o!==0){return o;}}return 0;});accountsGrid.invalidate();accountsGrid.render();
});accountsDataView.onRowCountChanged.subscribe(function(c,b){accountsGrid.updateRowCount();accountsGrid.render();});accountsDataView.onRowsChanged.subscribe(function(c,b){accountsGrid.invalidateRows(b.rows);
accountsGrid.render();});}}function updateAccountsGrid(d,c){c=(c!==undefined)?c:false;initAccountsGridEvents();function e(){$("#account-details .details").css("background","none");
accountsDataView.beginUpdate();accountsDataView.setItems(d);accountsDataView.endUpdate();}var a=[];if(c){e();$(document).trigger("LiveHelp.AccountsCompleted");
}else{if(a.length!=d.length){var b=(window.devicePixelRatio>1)?200:100;$.each(d,function(f,g){if(g.Image===undefined){g.Image=protocol+server+"/livehelp/image.php?ID="+g.ID+"&SIZE="+b;
$("<img />").load(function(){a.push(g.ID);if(a.length==d.length){e();$(document).trigger("LiveHelp.AccountsOpenLoaded");}}).attr("src",g.Image);}else{c=true;
}});if(c){e();$(document).trigger("LiveHelp.AccountsOpenLoaded");}}else{$(document).trigger("LiveHelp.AccountsCompleted");}}}function initAccountsGrid(g){if(session.length>0){var b=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Operators":service+"?Operators",d=new Date().toString("yyyy-MM-dd HH:mm:ss"),c="Session="+session+"&Cached="+d+"&Version=4.0&Format=json",f=$.jStorage.get("accounts",[]),a=lastUpdatedAccount(f);
if(f.length>0&&$("#account-details").css("display")!="none"&&!accountsLoaded){if(g!==undefined&&g===true){updateAccountsGrid(f,true);accountsLoaded=true;
}}else{var e=$(".accounts-grid .cell-inner");$.each(e,function(h,j){var k=$(j).data("id");j=$(j);$.each(accounts.Operator,function(m,n){var l="Offline";
if(k===parseInt(n.ID,10)){switch(parseInt(n.Status,10)){case 1:l="Online";break;case 2:l="Be Right Back";break;case 3:l="Away";break;}j.find(".cell-details.name").text(n.Firstname+" "+n.Lastname);
j.find(".cell-details.department").text(n.Department);j.find(".cell-details.status").text(l);return;}});});}$(document).trigger("LiveHelp.AccountsOpened");
$.ajax({url:b,data:c,type:"POST",success:function(h){if(h.Operators!==undefined&&h.Operators.Operator!==undefined){accounts=h.Operators;$.jStorage.set("accounts",accounts.Operator);
$(document).trigger("LiveHelp.AccountsUpdated",[accounts.Operator]);if(g!==undefined&&g===true){showAccountsGrid(h.Operators.Operator);}else{$(document).trigger("LiveHelp.AccountsCompleted");
}}},dataType:"json"});}}function closeAccountDetails(){var c=$("#account-details"),b=c.find(".button-toolbar.save"),a=c.find(".button-toolbar.edit"),d=c.find(".header").text();
height=b.height();if(d==="Add Account"||a.filter(":visible").length>0){showAccounts();return;}c.find(".LiveHelpInput, .password").hide();c.find(".value, .button-toolbar.edit").fadeIn();
b.hide().css("bottom",-height+"px");a.fadeIn().animate({bottom:"15px"},250,"easeInOutBack");}function validateField(b,c){var a=(b instanceof $)?b.val():$(b).val();
if($.trim(a)===""){$(c).removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);return false;}else{$(c).removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);
return true;}}function validateUsername(d,f){var c=(d instanceof $)?d.val():$(d).val(),b=$.jStorage.get("accounts",[]),a=false,e=$("#AccountID").val();
e=(e.length>0)?parseInt(e,10):0;$.each(b,function(g,h){h.ID=parseInt(h.ID,10);if((h.Username===c&&e===0)||(h.Username===c&&e>0&&e!==h.ID)){a=true;}});if($.trim(c)===""||a===true){$(f).removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);
return false;}else{$(f).removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);return true;}}function validateEmail(b,c){var a=(b instanceof $)?b.val():$(b).val();
if(/^[\-!#$%&'*+\\.\/0-9=?A-Z\^_`a-z{|}~]+@[\-!#$%&'*+\\\/0-9=?A-Z\^_`a-z{|}~]+\.[\-!#$%&'*+\\.\/0-9=?A-Z\^_`a-z{|}~]+$/i.test(a)){$(c).removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);
return true;}else{$(c).removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);return false;}}function validatePassword(c,a,d){var b=(c instanceof $)?c.val():$(c).val();
if($.trim(b)===""||b!==a){$(d).removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);return false;}else{$(d).removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);
return true;}}function saveAccount(){var c=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Operators":service+"?Operators",h=$.jStorage.get("accounts",[]),b=lastUpdatedAccount(h),f=($("#AccountStatusEnable").is(":checked"))?0:-1,g={Session:session,ID:$("#AccountID").val(),User:$("#AccountUsername").val(),Firstname:$("#AccountFirstname").val(),Lastname:$("#AccountLastname").val(),Email:$("#AccountEmail").val(),Department:$("#AccountDepartment").val(),Privilege:$("#AccountAccessLevel").val(),NewPassword:$("#AccountPassword").val(),Disabled:f,Cached:new moment(b.toString(),"YYYY-MM-DD HH:mm:ss").toDate(),Format:"json",Version:"4.0"};
validateAccount(false);if($("#account-details").find(".InputError.CrossSmall").length>0){return;}var d=$(".account-dialog");d.find(".progressring").show();
d.find(".title").text("Saving Account");d.find(".description").text("One moment while your account is saved.");d.animate({bottom:0},250,"easeInOutBack");
function e(){d.find(".progressring").hide();d.find(".title").text("Error Saving Account");d.find(".description").text("An error occurred while saving your account.  Please contact technical support.");
d.delay(2000).animate({bottom:-90},250,"easeInOutBack");}function a(n){if(n.Operators!==null&&n.Operators!==undefined&&n.Operators.Operator!==undefined){var l=n.Operators.Operator;
$.jStorage.set("accounts",l);$(document).trigger("LiveHelp.AccountsUpdated",[l]);var j=false;$.each(h,function(p,r){var o=parseInt(r.ID,10),q=false;$.each(l,function(t,u){var s=parseInt(u.ID,10);
if(o===s){q=true;}});if(!q){j=true;}});var m=lastUpdatedAccount(l);if(m>b||j){updateAccountsGrid(l,true);}$.each(l,function(o,p){if(p.ID===g.ID){showAccount(p);
return;}});closeAccountDetails();$(document).trigger("LiveHelp.AccountSaveCompleted");var k=$(".account-dialog");k.animate({bottom:-90},250,"easeInOutBack");
}else{e();}}if(accountFiles!==undefined){$("#account-upload").fileupload("send",{formData:g,files:accountFiles}).success(function(k,l,j){a(k);if(parseInt(g.ID,10)===operator.id){$(".operators .image.photo").css({"background-image":"url(http://"+server+"/image.php?ID="+operator.id+"&SIZE=40&"+$.now()+")"});
$(".accounts-grid .photo").css({"background-image":"url(http://"+server+"/livehelp/image.php?ID="+operator.id+"&SIZE=50&"+$.now()+")"});}$('#account-details .cell-inner[data-id="'+g.ID+'"] img').attr("src",protocol+server+"/livehelp/image.php?ID="+g.ID+"&SIZE=60&"+$.now());
}).error(function(j,l,k){e();});accountFiles=undefined;}else{$.ajax({url:c,data:g,type:"POST",success:function(j){a(j);},dataType:"json"});}}function showAddAccount(){$(".accounts-grid").fadeOut();
var c=$("#account-details"),b=c.find(".button-toolbar.save"),a=b.height(),d=c.find(".button-toolbar.edit, .button-toolbar.add");c.find(".header").text("Add Account");
c.find(".back, .back-background").fadeIn();c.find(".details").css("bottom","25px");c.find(".value, .label.devices").hide();c.find("input, select, .password").val("").fadeIn();
c.find(".scroll, .button-toolbar.save, .LiveHelpInput, #account-upload, .upload, #account-dropzone").fadeIn();c.find("#AccountStatusEnable").attr("checked","checked");
c.find(".InputError").removeClass("TickSmall CrossSmall");d.css("bottom",-a+"px").hide();b.fadeIn().animate({bottom:"15px"},250,"easeInOutBack");$(document).trigger("LiveHelp.ShowAccountLoaded");
}function validateAccount(c){var e=$("#account-details"),f=e.find("input, select, .password").filter(":not(#AccountUsername, #AccountEmail, #AccountPasswordConfirm)");
if(!c){f=e.find("input, select").filter(":not(#AccountUsername, #AccountEmail, #AccountPasswordConfirm, #AccountPassword)");}$.each(f,function(h,j){var k=$(j).attr("id");
validateField($(j),"#"+k+"Error");});var d=$("input#AccountUsername"),g=d.attr("id");validateUsername(d,"#"+g+"Error");d=$("input#AccountEmail");g=d.attr("id");
validateEmail(d,"#"+g+"Error");var a=$("#AccountPassword"),b=$("#AccountPasswordConfirm");if(!c){if(a.val().length===0&&b.val().length===0){return;}}g=b.attr("id");
validatePassword(b,a.val(),"#"+g+"Error");}function updateAccountImage(b){var a=$("#account-upload");a.find(".image").css({background:"url("+b+") no-repeat",opacity:1,width:"100px",height:"100px",padding:0,"background-size":"100px 100px"});
a.css({border:"none","border-radius":0,background:"transparent"}).fadeIn();$(".upload").hide();}var accountFiles;function addAccount(){var f=$("#account-details"),d=f.find("#AccountStatusEnable").is(":checked")?0:-1,b={Session:session,User:f.find("#AccountUsername").val(),Firstname:f.find("#AccountFirstname").val(),Lastname:f.find("#AccountLastname").val(),Email:f.find("#AccountEmail").val(),Department:f.find("#AccountDepartment").val(),NewPassword:f.find("#AccountPassword").val(),Privilege:f.find("#AccountAccessLevel").val(),Disabled:d,Format:"json",Version:"4.0"};
validateAccount(true);if(f.find(".InputError.CrossSmall").length>0){return;}var a=$(".account-dialog");a.find(".progressring").show();a.find(".title").text("Adding Account");
a.find(".description").text("One moment while you account is created.");a.animate({bottom:0},250,"easeInOutBack");function e(h){if(h.Operators!==undefined&&h.Operators.Operator!==undefined){var g=h.Operators.Operator;
showAccountsGrid(g);showAccounts();var j=0;$.each(g,function(k,l){if(l.Username===b.User){j=parseInt(l.ID,10);return false;}});if(j>0){$('#account-details .cell-inner[data-id="'+j+'"] img').attr("src",protocol+server+"/livehelp/image.php?ID="+j+"&SIZE=60&"+$.now());
}}a.animate({bottom:-90},250,"easeInOutBack");}function c(){a.find(".progressring").hide();a.find(".title").text("Error Adding Account");a.find(".description").text("An error occurred while adding your account.  Please contact technical support.");
}if(accountFiles!==undefined){$("#account-upload").fileupload("send",{formData:b,files:accountFiles}).success(function(h,j,g){e(h);}).error(function(g,j,h){c();
});accountFiles=undefined;}else{$.ajax({url:(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Operators":service+"?Operators",data:b,type:"POST",success:function(g){e(g);
},error:function(g,j,h){c();},dataType:"json"});}}function deleteAccount(){var a=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Operators":service+"?Operators",d={Session:session,ID:$("#AccountID").val(),Format:"json",Version:"4.0"};
var b=$(".confirm-delete");function c(){b.find(".progressring").hide();b.find(".title").text("Error Deleting Account");b.find(".description").text("An error occurred while deleting your account.  Please contact technical support.");
b.delay(2000).animate({bottom:-90},250,"easeInOutBack");}function e(g){if(g.Operators!==null&&g.Operators!==undefined&&g.Operators.Operator!==undefined){var f=g.Operators.Operator;
showAccountsGrid(f);showAccounts();b.delay(2000).animate({bottom:-90},250,"easeInOutBack");}else{c();}}$.ajax({url:(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Operators":service+"?Operators",data:d,type:"POST",success:function(f){e(f);
},error:function(f,h,g){c();},dataType:"json"});}function refreshAccounts(a){switch(a){case"Online":a=1;break;case"BRB":a=2;break;case"Away":a=3;break;
default:a=0;break;}$.each(accounts.Operator,function(b,c){if(operator.id===parseInt(c.ID,10)){c.Status=a;}});}function showAccount(d){$(".accounts-grid").fadeOut();
$(document).trigger("LiveHelp.AccountLoaded",d);var f=$("#account-details .details .btn-group"),c="Offline";if(operator.access>=2){f.hide();}else{f.css("display","inline-block");
}d.status=parseInt(d.Status,10);switch(d.status){case 1:c="Online";break;case 2:c="Be Right Back";break;case 3:c="Away";break;}f.find(".status").text(c);
if(d.status!==1){f.find(".btn").addClass("disabled");}else{f.find(".btn").removeClass("disabled");}f.find(".dropdown-menu.statusmode li a").on("click",function(){var p=$(".account-dialog");
p.find(".progressring").show();p.find(".title").text("Updating Operator Status Mode");p.find(".description").text("One moment while the operator status mode is updated.");
p.animate({bottom:0},250,"easeInOutBack");var q=$("#account-details .details #AccountID").val(),o=o,n=$(this).attr("class");updateUsers(n,q,function(){refreshAccounts(n);
n=(n==="BRB")?"Be Right Back":n;$("#account-details .dropdown-toggle .status").text(n);p.delay(1000).animate({bottom:-90},250,"easeInOutBack");});});$.jStorage.set("account",d);
var g=$("#account-details");g.find(".header").text(d.Firstname+" "+d.Lastname);g.find(".back, .back-background").fadeIn();var m=(window.devicePixelRatio>1)?200:100;
updateAccountImage(protocol+server+"/livehelp/image.php?ID="+d.ID+"&SIZE="+m);g.find("#AccountID").val(d.ID);g.find(".username.value").text(d.Username);
g.find("#AccountUsername").val(d.Username);g.find(".firstname.value").text(d.Firstname);g.find("#AccountFirstname").val(d.Firstname);g.find(".lastname.value").text(d.Lastname);
g.find("#AccountLastname").val(d.Lastname);g.find(".email.value").text(d.Email);g.find("#AccountEmail").val(d.Email);g.find(".department.value").text(d.Department);
g.find("#AccountDepartment").val(d.Department);var a=parseInt(d.Privilege,10);g.find("#AccountAccessLevel").val(a);a=convertAccessLevel(d.Privilege);g.find(".accesslevel.value").text(a);
var b=parseInt(d.Disabled,10),h="Disabled";if(b===0){g.find("#AccountStatusEnable").attr("checked","checked");h="Enabled";}else{g.find("#AccountStatusDisable").attr("checked","checked");
h="Disabled";}g.find(".accountstatus.value").text(h);var e="";if(d.Devices!==undefined){$.each(d.Devices,function(n,o){e+='<div class="device value">'+o.Device+" - "+o.OS+"</div>";
});}if(e.length>0){g.find(".devices.value").html(e);g.find(".devices.label").show();}else{g.find(".devices.value").html("");g.find(".devices.label").hide();
}g.find(".details").css("bottom","25px");g.find(".value").show();g.find(".LiveHelpInput, .password, .button-toolbar.save").hide();g.find(".scroll").fadeIn();
var j=g.find(".button-toolbar.edit"),l=j.height(),k=g.find(".button-toolbar.add, .button-toolbar.save");k.css("bottom",-l+"px").hide();j.fadeIn().animate({bottom:"15px"},250,"easeInOutBack");
}function showAccounts(){var e=$("#account-details"),d=e.find(".button-toolbar"),f=e.find(".button-toolbar.add"),c=e.find(".confirm-delete"),b=e.find("#account-upload"),a=d.height();
e.find(".header").text("Add / Edit Accounts");e.find(".scroll").fadeOut();e.find("#account-image, .upload, #account-dropzone").fadeOut();e.find(".back, .back-background").fadeOut();
e.find(".details").css("bottom",0);b.hide().find(".image").css({background:"none",opacity:0.5,width:"60px",height:"60px",padding:"20px"});b.css({border:"2px dashed #CCC","border-radius":"20px",background:"#fafafa"});
d.fadeOut().css("bottom",-a+"px");if(operator.access>=2){f.fadeOut();}else{f.fadeIn().animate({bottom:"15px"},250,"easeInOutBack");}c.animate({bottom:"-90px"},250,"easeInOutBack");
$(".accounts-grid").fadeIn();$("#account-details .details .btn-group").hide();if(e.filter(":visible").length>0){$.jStorage.set("account",null);initAccountsGrid(true);
}}function openAccounts(){var a=$("#account-details"),b=a.find(".button-toolbar.add");if(operator.access>=2){b.hide();}a.show();a.css("z-index",sliderIndex()+100);
a.animate({width:"40%",opacity:1},250,function(){var c=$.jStorage.get("account",null),d=$.jStorage.get("accounts",[]);if(c!==null){$.each(d,function(e,f){if(c.ID===f.ID){c=f;
}});showAccount(c);return;}initAccountsGrid(true);});}function closeAccount(){var b=$("#account-details"),a=b.width();b.animate({width:0,opacity:0},250,function(){b.hide();
});switchPreviousMenu();}var notifications=[];function updateUser(e,f){var b="",c=false,a=false.hash="",d=window.location.pathname;defaultimage=(server.length>0)?protocol+server+defaultUserImage:encodeURIComponent(window.location.protocol+"//"+window.location.host+d.replace(d.substring(d.indexOf("/livehelp/admin/")),defaultUserImage)),chatting=$(".chatting.list"),otherchatting=$(".other-chatting.list"),pending=$(".pending.list"),operators=$(".operators.list"),element=null,height=0,alert=false,chatstotal=$("#chatstotal");
if(e==="Online"){element=otherchatting;updateTotal(chatstotal,f.length);}else{if(e==="Pending"||e==="Transferred"){element=pending;alert=true;}else{if(e==="Staff"){element=operators;
a=true;}}}if(element!==null){if(f.length>0){$.each(f,function(t,r){b="";if(e==="Online"){if(parseInt(r.Active,10)===operator.id){element=chatting;}else{element=otherchatting;
}}hash=CryptoJS.MD5(r.Email);c=false;$.each(element.find(".visitor"),function(D,E){var v=parseInt(r.ID,10);if(v===$(E).data("id")){c=true;if(e==="Online"){var y=parseInt(r.Messages,10),w=$(E).data("messages"),z=y-w,C=$(".chat-stack"),B=C.position().top,A=C.find(".chat[data-id="+v+"]").length,x=(B<0||A===0)?false:true;
if(z>0&&!x){$(E).find(".message-alert").text(z).fadeIn();}}return;}});if(!c){var g=ucwords(r.Name.toLowerCase());if(a){var j=$.jStorage.get("accounts",[]),p=r.Department,l=(r.Access!==undefined)?convertAccessLevel(r.Access):"",q="",o=parseInt(r.Status,10);
if(r.Firstname!==undefined&&r.Firstname.length===0){$.each(j,function(v,w){if(parseInt(w.ID,10)===parseInt(r.ID,10)){g=w.Firstname;p=w.Department;l=convertAccessLevel(w.Privilege);
return;}});}else{g=r.Firstname;}if(parseInt(r.ID,10)===operator.id){q=" photo";}if(o===1){b='<div class="visitor" data-id="'+r.ID+'" data-messages="0"><span class="image'+q+'" style="background-image:url(\''+protocol+server+"/livehelp/image.php?ID="+r.ID+'&SIZE=40\')"></span><span class="details name">'+g+'</span><span class="details department">'+p+'</span><span class="details accesslevel">'+l+'</span><span class="message-alert red" style="display:none">0</span></div>';
}}else{var n=parseInt(r.Messages,10),h=parseInt(r.ID,10);b='<div class="visitor" data-id="'+h+'" data-messages="'+n+'"><span class="image" style="background-image:url(\'https://secure.gravatar.com/avatar/'+hash+"?s=40&r=g&d="+defaultimage+'\')"></span><span class="details name">'+g+'</span><span class="details department">'+r.Department+'</span><span class="details accesslevel">'+r.Server+'</span><span class="message-alert red" style="display:none">0</span></div>';
var s=$.jStorage.get("html5-notifications",false);c=false;$.each(notifications,function(v,w){if(w.id===h){c=true;return false;}});if(e==="Pending"||e==="Transferred"){if(!c&&s&&window.webkitNotifications.checkPermission()===0){var u=g+" is waiting for Live Chat";
if(r.Department.length>0){u+=" ("+r.Department+")";}var k=window.webkitNotifications.createNotification(notificationIcon,e+" Chat Request",u);notifications.push({id:h,section:e,notification:k});
k.onclick=function(w){var x=0,v=null;$.each(notifications,function(y,z){x=z.id;if(x>0){v=$(".pending .visitor[data-id="+x+"]");if(v&&v.length>0){acceptChat(v);
}}});};k.show();}}else{if(e==="Online"){$.each(notifications,function(v,w){if(w.id===h){w.notification.cancel();return false;}});}}}if(alert&&pendingSound!==undefined){pendingSound.play();
}}if(b.length>0){element.find(".no-visitor").hide();var m=$(b).appendTo(element);$(m).data("user",r);}});height=element.find(".visitor").length*74;if(height>0){element.data("height",height);
if(element.height()>0){element.animate({height:height},250,"easeOutBack");}}height=chatting.find(".visitor").length*74;if(height>0){chatting.data("height",height);
if(chatting.height()>0){chatting.animate({height:height},250,"easeOutBack");}}}else{if(e!="Pending"&&e!="Transferred"){clearUsers(element);if(e==="Online"){clearUsers(chatting);
}}if(e==="Pending"||e==="Transferred"){$.each(notifications,function(g,h){if(h.section===e){h.notification.cancel();}});}}}}var chattingVisitorHeight=38;
var noVisitorsHeight=38;function clearUsers(a){a.find(".visitor").remove();a.find(".no-visitor").show();a.height(noVisitorsHeight);a.data("height",noVisitorsHeight);
}function removeVisitor(b,a){a.remove();height=b.find(".visitor").length*74;if(height>0){if(b.height()>0){b.animate({height:height},250,"easeOutBack");
}b.data("height",height);}}var users={},usersTimer;function updateUsers(c,d,a){if(session.length>0){var b=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Users":service+"?Users";
post={Session:session,Version:"4.0",Format:"json"};if(c!==undefined){$.extend(post,{Action:c});}if(d!==undefined){$.extend(post,{ID:d});}window.clearTimeout(usersTimer);
$.ajax({url:b,data:post,type:"POST",success:function(e){updateUsersInterface(e,c,d);if(a){a();}},dataType:"json",error:function(e,g,f){usersTimer=window.setTimeout(updateUsers,10000);
}});}}function updateUsersInterface(g,d,b){if(g.Users!==undefined){$(document).trigger("LiveHelp.UsersCompleted",{newUsers:g.Users,previousUsers:users});
users=g.Users;var f=$(".operators .visitor"),a=$(".chatting .visitor, .other-chatting .visitor"),c=$(".pending .visitor"),h=$(".operators.list"),e=b;var j=0;
$.each(f,function(m,o){var l=$(o),p=l.data("id"),n=false;$.each(users.Staff.User,function(q,r){if(parseInt(r.ID,10)===p&&parseInt(r.Status,10)===1){n=true;
j++;}});if(!n){removeVisitor(h,l);}});if(j===0){clearUsers(h);}$.each(users.Online.User,function(l,m){if(d==="Accept"&&e===parseInt(m.ID,10)&&parseInt(m.Active,10)===operator.id){openChat(b,m);
}});h=$(".chatting.list");if(a.length>0){var k=0;$.each(a,function(m,o){var l=$(o),p=l.data("id"),n=false;$.each(users.Online.User,function(q,r){if(parseInt(r.ID,10)===p){n=true;
}if(parseInt(r.Active,10)===operator.id){k++;}});if(!n){removeVisitor(h,l);}});if(k===0){clearUsers(h);}}else{clearUsers(h);}if(users.Pending.User.length>0){showPendingNotification(users.Pending.User);
}else{closeNotification();}h=$(".pending.list");if(c.length>0){$.each(c,function(m,p){var l=$(p),q=l.data("id"),o=false,n=users.Pending.User.length+users.Transferred.User.length;
$.each(users.Pending.User,function(r,s){if(parseInt(s.ID,10)===q){o=true;return false;}});$.each(users.Transferred.User,function(r,s){if(parseInt(s.ID,10)===q){o=true;
return false;}});if(!o){removeVisitor(h,l);}if(n===0){clearUsers(h);}});}else{clearUsers(h);}$.each(users,function(m,l){updateUser(m,l.User);});}usersTimer=window.setTimeout(updateUsers,10000);
}function convertAccessLevel(a){var b=parseInt(a,10);switch(b){case -1:case 0:a="Full Administrator";break;case 1:a="Department Administrator";break;case 2:a="Limited Administrator";
break;case 3:a="Sales / Support Staff";break;case 4:a="Guest";break;}return a;}function openChat(j,r){var f=$(".chat-stack"),d=f.find(".chat"),g='<div class="chat" style="left:0; bottom:0; background-color:#ffffff; z-index:500" data-id="'+j+'"><div class="name"></div><span class="message-alert red" data-total="0" style="bottom:10px; right:7px; top:auto; display:none">2</span><div class="inputs"><div class="close"></div><div class="title"><span style="background: url(http://'+server+'/livehelp/image.php?SIZE=50) #fff; width:50px; height:50px; float:left; margin:5px 10px; display:block"></span><span class="title"><span></div><div class="scroll"><div class="messages"></div><div class="end"></div></div></div></div>',l=false,c=false;
$.each(d,function(u,w){var t=$(w),v=t.data("id");if(v===j){l=true;}if(t.height()===0){c=true;}});if(!l){$.each(d,function(x,z){var u=$(z),w=u.css("z-index"),A=parseInt(u.css("left"),10),v=u.find(".name"),t=u.find(".inputs, input"),y=u.data("id");
if(x===0){u.css({bottom:2+"px","background-color":"#fafafa",left:A+35+"px"});}else{u.css({bottom:4+"px","background-color":"#f6f6f6",left:A+35+"px"});}u.css("z-index",w-10);
v.show();t.hide();});$(g).prependTo(f);}else{if(c){$.each(d,function(v,w){var u=$(w),x=parseInt(u.css("left"),10),t=u.height();if(t>0){if(x===0){u.find(".name").show();
u.find(".close, .inputs").hide();}u.animate({left:x+35},250);}else{u.css({height:"auto"});}});}}var h=$(document).height()-10,m=f.find(".chat[data-id="+j+"]"),s=ucwords(r.Name),q=(r.Email.length>0)?s+" - "+r.Email:s;
m.find(".name").text(s).hide();m.find(".inputs").show();m.find(".title").text(q);m.data("closed",false);f.find(".typing .name").text(s);if(parseInt(f.css("top"),10)!==0){m.click();
f.animate({top:0,bottom:chatstack.bottom,opacity:1,height:h},250,function(){$(this).css({height:"auto"});});}else{var b=parseInt(m.css("left"),10);if(b===0){var p=50,k="easeOutBack";
for(i=0;i<3;i++){m.animate({bottom:-5},p,k).delay(p).animate({bottom:0},p,k);}m.find("#message").focus();}else{m.click();}}var e=f.find(".typing");$.each(activechats,function(t,u){if(u.id!==undefined&&u.id==j&&u.typing){e.show();
return false;}else{e.hide();}});$(".chat-stack .smilies.button").close();checkBlocked(j);var n=$(".visitor[data-id="+j+"]"),a=n.find(".message-alert"),o=parseInt(n.data("messages"),10)+parseInt(a.text(),10);
n.data("messages",o);a.fadeOut();}function closeChats(){var b=$(".chat-stack"),a=b.height();$(".chat-stack .smilies.button").close();b.animate({top:-a,bottom:30+a},250);
return false;}function showPendingNotification(f){var e=$(".notification"),d="Pending Chat",b="",a="",c="";if(f.length>1){d="Pending Chats";b=f.length+" visitors are pending for Live Chat";
}else{if(f.length===1){a=ucwords(f[0].Name.toLowerCase());c=f[0].Server;if(c.length>0){b=a+" is pending for Live Chat at "+c;}else{b=a+" is pending for Live Chat";
}}}e.off("click");e.on("click",function(){if(f.length===1){var h=parseInt(f[0].ID,10),g=$(".pending .visitor[data-id="+h+"]");acceptChat(g);}});if(b.length>0){if(e.find(".icon").css("background-image").indexOf("ChatNotification.png")===-1){e.find(".icon").css({"background-image":"url(images/ChatNotification.png)",width:"36px",height:"26px"});
}e.find(".notify").text(d);e.find(".notify").text(b);showNotification({title:d,text:b,users:f});}}var notificationUsers=[];function showNotification(b){var a=false;
$.each(b.users,function(c,e){var f=parseInt(e.ID,10),d=false;$.each(notificationUsers,function(h,g){if(f===g){d=true;return false;}});if(!d){notificationUsers.push(f);
}else{a=true;}});if(!a){if(notification){$(".notification").animate({top:-20},250,"easeInOutBack");}$(document).trigger("LiveHelp.Notification",b);}}function closeNotification(){notificationUsers=[];
var b=$(".notification"),a=parseInt(b.css("top"),10);if(a>=-20){b.animate({top:-80},500,"easeInOutBack");}}function sendMessage(d){var b=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Send":service+"?Send",a=$(".chat-stack textarea"),g=$(".chat-stack .chat"),f=0,e=(d!==undefined)?d:a.val(),c={Session:session,Message:e,Staff:0,Version:"4.0",Format:"json"};
$.each(g,function(h,j){if($(j).position().left===0){f=$(j).data("id");return;}});if(f>0){c.ID=f;$.ajax({url:b,data:c,type:"POST",success:function(h){},dataType:"json"});
a.val("");}return false;}function sendCommand(f,d,b,e){var a=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Send":service+"?Send",c={Session:session,ID:f};
d=(d!==undefined)?d:"";b=(b!==undefined)?b:"";e=(e!==undefined)?e:"";$.extend(c,{Type:d,Name:b,Content:e,Staff:"0",Version:"4.0",Format:"json"});$.ajax({url:a,data:c,type:"POST",success:function(g){},dataType:"json"});
return false;}function filterResponses(){var a=$("#responses #search").val(),d=(a!==undefined&&a.length>0)?a.split(" "):"",f=[],b=[],c=["Text","Hyperlink","Image","PUSH","JavaScript"];
if(d.length>0){$.each(responses,function(g,h){if($.inArray(g,c)>-1){$.each(h,function(k,j){var m=parseInt(j.ID,10),l=false;$.each(d,function(n,o){if(j.Name.toLowerCase().indexOf(o)>-1||j.Content.toLowerCase().indexOf(o)>-1){l=true;
return false;}});if(l){f.push(m);}else{b.push(m);}});}});}if(responses.length===0){f.push(b);}var e=$("#responses .response");if(f.length===0&&b.length===0){e.show();
}else{$.each(f,function(g,h){e.filter("[data-id="+h+"]").show();});$.each(b,function(g,h){e.filter("[data-id="+h+"]").hide();});}}function processEscKeyDown(){var c=$(".slider.right"),f=$("#visitor-details"),e=$("#account-details"),b=$("#settings"),d=$(".accounts-grid"),a=0,g=null;
if(b.height()>0&&b.width()>0){closeSettings();return;}$.each(c,function(l,m){var k=$(m),j=parseInt(k.css("z-index"),10);if(k.width()>0&&j>a){g=k;a=j;}});
if(g!==null){var h=g.attr("id");switch(h){case"responses":closeResponses();break;case"visitor-details":closeVisitor();break;case"account-details":if(d.is(":visible")===false){showAccounts();
}if(e.is(":visible")&&e.width()>0){closeAccount();}break;case"history-chat":closeHistory();break;}return;}if(parseInt($(".chat-stack").css("top"),10)===0){closeChats();
return;}}var responses={},tags=[];function updateResponses(c){var b=$("#responses .scroll #response-list"),a=["Text","Hyperlink","Image","PUSH","JavaScript","Other"],d={};
$(".chat-stack .options.dropdown-menu > li").filter(".text, .hyperlink, .image, .push, .javascript").find("> .dropdown-menu").remove();b.html("");$.each(c,function(e,g){if($.inArray(e,a)>-1){var h=(e==="PUSH"||e==="Hyperlink")?'<span style="position: absolute; right: 40px">'+e+"</span>":"";
e=e.toLowerCase();$('<div class="'+e+'" />').appendTo(b);if(d[e]===undefined){d[e]=$("#response-list ."+e);}var j=$(".chat-stack .options.dropdown-menu ."+e);
if(g.length>0&&j.find("ul").length===0){j.addClass("dropdown-submenu");$('<ul class="dropdown-menu"></ul>').appendTo(j);}j=j.find(".dropdown-menu");var f=false;
if(g.length>0&&g[0].Custom!==undefined){g=g[0].Custom;f=true;}$.each(g,function(u,o){if(u=="Description"){var n=$(".chat-stack .options.dropdown-menu"),t=n.find(".other.menuitem");
t.find("> a").text(o);t.show();n.find(".other.divider").show();}else{var m=parseInt(o.ID,10),v="",q="display: none",r=o.Content,k=$('<li class="responseitem submenu"><a href="#">'+o.Name+"</a></li>");
k.data("response",o);if(o.Category.length>0){var p=j.find("li."+e+".category a"),s=false;$.each(p,function(w,y){var x=$(y);if(x.text()===o.Category){s=x;
return;}});if(!s){var l=$('<li class="'+e+' category dropdown-submenu"><a href="#">'+o.Category+'</a><ul class="dropdown-menu"></ul></li>');k.appendTo(l.find(".dropdown-menu"));
l.appendTo(j);}else{k.appendTo(s.parent().find("ul.dropdown-menu"));}}else{k.appendTo(j);}if(o.Tags!==undefined){if(o.Tags.length>0){$.each(o.Tags,function(x,w){w=w.toLowerCase();
if($.inArray(w,tags)===-1){tags.push(w);}});q="display: inline-block";v=o.Tags.join(", ");}else{q="display: none";}}r=r.replace(/^(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)$/img,'<img src="$&" style="max-width: 300px"/>');
$('<div class="response" data-id="'+m+'"><div class="label">'+o.Name+h+'</div><div class="edit" title="Edit Response"></div><div class="content">'+r+'</div><div class="tags"><span class="tag-icon" style="'+q+'"></span><span class="tag">'+v+'</span></div><div class="send" title="Send Response"></div></div>').appendTo(d[e]);
}});}});}function loadResponses(){if(session.length>0){var a=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Responses":service+"?Responses",b="Session="+session+"&Version=4.0&Format=json";
$.ajax({url:a,data:b,type:"POST",success:function(c){if(c!==undefined&&c.Responses!==undefined){responses=c.Responses;updateResponses(responses);}$(".responseitem.submenu").on("click",function(){var d=$(this).data("response"),e="Text";
switch(d.Type){case 2:e="Hyperlink";break;case 3:e="Image";break;case 4:e="PUSH";break;case 5:e="JavaScript";break;}sendResponse(e,d);});},dataType:"json"});
}}function updateTotal(a,b){var c=parseInt(a.data("total"),10);if(b!==c){a.animate({height:0},350,"easeInOutBack",function(){a.text(b);a.animate({height:38},350,function(){a.data("total",b);
});});}}function toggleChatMenu(c,a){var b="expander sprite sort-desc",d=c.attr("id");if(a>0){b="expander sprite sort-asc";}$.jStorage.set(d+".height",a);
c.animate({height:a},250,"easeOutBack",function(){if(a>0){c.show();}else{c.hide();}$(this).prev().find(".expander").removeAttr("class").addClass(b);});
}function openHistory(){$(".visitors-grid, .visitors-empty, .visitors-menu, .worldmap, .statistics").fadeOut();$(".history").fadeIn(function(){if(historyChartData.length>0){showHistoryChart();
}});initHistoryGrid();}function openStatistics(){$(".visitors-grid, .visitors-empty, .visitors-menu, .worldmap, .history").fadeOut();$(".statistics").fadeIn(function(){if(ratingChartData.length>0){showRatingChart();
}if(weekdayChartData.length>0){showWeekdayChart();}});}var previousMenu="";function switchMenu(b){var a="",d=["home","statistics","history"];switch(b){case"home":openHome();
previousMenu=b;break;case"statistics":openStatistics();previousMenu=b;break;case"history":openHistory();previousMenu=b;break;case"responses":openResponses();
a=b;break;case"accounts":openAccounts();a=b;break;case"settings":openSettings();a=b;break;}$(document).trigger("LiveHelp.MenuChanged",b);if(a.length>0){$.jStorage.set("popout",a);
}var c=$(".menu li a");c.removeClass("selectedMenu");c.filter("[data-type="+b+"]").addClass("selectedMenu");}function switchPreviousMenu(){$.jStorage.set("popout","");
if(previousMenu.length>0){var a=$(".menu li a");a.removeClass("selectedMenu");a.filter("[data-type="+previousMenu+"]").addClass("selectedMenu");}}function loadLocalSettings(){var a=[{id:"operators",height:38},{id:"chatting",height:38},{id:"other-chatting",height:0},{id:"pending",height:38}];
$.each(a,function(e,f){var d=$.jStorage.get(f.id+".height",f.height),g=$("#"+f.id);toggleChatMenu(g,d);});var c=$.jStorage.get("menu","home");switchMenu(c);
var b=$.jStorage.get("popout");switch(b){case"responses":openResponses();break;case"accounts":openAccounts();break;case"settings":openSettings();break;
}}var session="",factor="",error=false;function signInComplete(){$(".login").fadeOut();$(".content").animate({opacity:1},250);$(document).trigger("LiveHelp.SignInCompleted");
if(operator.access>3){$(".menu a[data-type=statistics]").parent().hide();$(".menu a[data-type=history]").parent().hide();$(".menu a[data-type=accounts]").parent().hide();
}if(messageSound===undefined){messageSound=new buzz.sound("../sounds/New Message",{formats:["ogg","mp3","wav"],volume:100});}if(pendingSound===undefined){pendingSound=new buzz.sound("../sounds/Pending Chat",{formats:["ogg","mp3","wav"],volume:100});
}operator=$.jStorage.get("operator");if(operator!==undefined){$(".operator .photo").css("background-image","url(http://"+server+"/livehelp/image.php?ID="+operator.id+"&SIZE=50)");
$(".operator .name").text(operator.name);}$(".login").find("input[type!=reset][type!=submit], select").val("");loadLocalSettings();updateUsers();updateVisitorsGrid();
loadStatisticsChartData();initAccountsGrid(false);loadResponses();initWorldMap();var a=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Settings":service+"?Settings",b={Session:session,Version:"4.0",Format:"json"};
$.ajax({url:a,data:b,type:"POST",success:function(c){if(c.Settings!==undefined){loadSettings(c.Settings);$(document).trigger("LiveHelp.SettingsInitialised",c.Settings);
var d=$(".chat-stack .dropdown-menu.options");$(".chat-stack .dropdown-toggle.options").click(function(){var f=d.find(".EmailChatOffline");f.text("Offline Email Address ("+c.Settings.Email+")");
var h=$(".chat-stack .chat"),e=$(".chatting .visitor"),g=0;$.each(h,function(j,k){if($(k).position().left===0){g=$(k).data("id");return;}});f.data("id",g);
$.each(e,function(k,l){if($(l).data("id")===g){var j=$('.chatting .visitor[data-id="'+g+'"]').data("user").Email,m=d.find(".EmailChatVisitor");m.text("Visitor's Email Address ("+j+")").data("email",j);
m.data("id",g);return;}});});d.find(".Close").click(function(){closeChat();});d.find(".Block").click(function(){blockChat();});d.find(".EmailChatOffline").click(function(){emailChat($(this).data("id"),"");
});d.find(".EmailChatVisitor").click(function(){emailChat($(this).data("id"),$(this).data("email"));});}},dataType:"json"});}function closeChat(){var e=$(".chat-stack .chat"),a=[],b=null,d=0;
$.each(e,function(g,h){var f=$(h),j=f.position().left;if(j===0){d=f.data("id");b=h;return;}});if(b!==null){var c=$(".chat-stack .dialog");c.find(".progressring img").attr("src","images/ProgressRing.gif");
c.find(".dialog-title").text("Closing Chat Session");c.find(".dialog-description").text("One moment while the chat session is closed.");c.show().animate({bottom:"1px"},250);
updateUsers("Close",d,function(){c.animate({bottom:"-145px"},250,function(){$(this).hide();});if(e.length>1){$.each(e,function(h,j){var g=$(j),k=g.position().left,f=g.height();
if(k===0){g.animate({height:-f},250,function(){$(this).remove();});g.find(".inputs").hide();return;}else{if(k==35){g.find(".name").hide();g.find(".inputs").show();
}g.animate({left:k-35},250);}});}else{e.remove();closeChats();}e=[];$.each(activechats,function(f,g){if(g.id!==d){e.push(g);return;}});activechats=e;$(document).trigger("LiveHelp.CloseChatCompleted");
});return;}}function blockChat(){var e=$(".chat-stack .chat"),a=[],b=null,d=0;$.each(e,function(g,h){var f=$(h),j=f.position().left;if(j===0){d=f.data("id");
b=h;return;}});if(b!==null){var c=$(".chat-stack .dialog");c.find(".progressring img").attr("src","images/ProgressRing.gif");c.find(".dialog-title").text("Blocking Chat Session");
c.find(".dialog-description").text("One moment while the chat session is blocked.");c.show().animate({bottom:"1px"},250);updateUsers("Block",d,function(){c.find(".progressring img").attr("src","images/Block.png");
c.find(".unblock").fadeIn();c.find(".dialog-title").text("Chat Session Blocked");c.find(".dialog-description").text("The chat session is blocked and inactive.");
var f=null,g=false,h=[];$.each(activechats,function(j,k){if(k.id===d){f=k;}else{h.push(k);}});activechats=h;$.each(blockedchats,function(j,k){if(k.id===d){g=true;
return;}});if(!g){if($.inArray(d,blockedchats)===-1){blockedchats.push(f);}}});}}function unblockChat(c,b){var a=[];b.find(".progressring img").attr("src","images/ProgressRing.gif");
b.find(".dialog-title").text("Unblocking Chat Session");b.find(".dialog-description").text("One moment while the chat session is unblocked.");updateUsers("Unblock",c,function(){b.find(".progressring img").fadeOut();
b.find(".dialog-title").text("Chat Session Unblocked");b.find(".dialog-description").text("The chat session is nunblocked and can now request Live Chat.");
b.animate({bottom:"1px"},250,function(){b.find(".unblock").hide();b.hide();});$.each(blockedchats,function(e,d){if(d.id===c){exists=true;return;}else{a.push(d);
}});blockedchats=a;});}function emailChat(d,b){var a=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?EmailChat":service+"?EmailChat",c={Session:session,ID:d,Email:b,Version:"4.0",Format:"json"};
$.ajax({url:a,data:c,type:"POST",success:function(e){},dataType:"json"});}function signInError(c){var a=$(".login, .inputs"),b=$(".login .error .text");
if(c.status===503&&c.statusText==="License Invalid"){b.text("License Invalid");cache=true;}else{if(c.getResponseHeader("X-Disabled")==="*"){b.text("Account Disabled");
}else{b.text("Incorrect Username / Password");}}a.find(".error").fadeIn();a.effect("shake",{times:3,distance:10},150);b=true;}function signIn(){if(session.length>0&&factor.length>0){twofactorAuth();
return;}var c=$(".login");server=c.find("input#server").val();protocol=c.find("input#ssl").is(":checked")?"https://":"http://";if($.jStorage.get("server","").length>0){server=$.jStorage.get("server","");
protocol=$.jStorage.get("protocol","http://");}if(document.location.protocol=="https:"){protocol="https://";$.jStorage.set("protocol",protocol);}var d=(server.length>0)?protocol+server+"/livehelp/xml/WebService.php?Login":service+"?Login",b=c.find("input#username").val(),g=c.find("input#password").val(),a=c.find("select#status").val(),e={Version:"4.0",Format:"json"};
if(b.length>0&&g.length>0){$.extend(e,{Username:b,Password:g,Action:a});}else{var f=$.jStorage.get("session","");if(f.length>0){$.extend(e,{Session:f});
}server=$.jStorage.get("server","");protocol=$.jStorage.get("protocol","http://");}if(server.length===0){var h=(document.location.pathname.indexOf("/livehelp")>0)?document.location.pathname.substring(0,document.location.pathname.indexOf("/livehelp")):"";
server=document.location.host+h;}if(cache){$.extend(e,{cache:""});}$.ajax({url:d,data:e,type:"POST",success:function(o){if(o.Login!==undefined){if(o.factors!==undefined){var p=o.factors,n=$(".twofactor"),l=$(".twofactorcode"),m={push:false,token:true,sms:false,telephone:false},j=220;
session=o.Login.Session;cache=false;$.each(p,function(r,s){var q=s.factor;if(q.indexOf("push")!==-1){m.push=true;}else{if(q.indexOf("token")!==-1){m.token=true;
}else{if(q.indexOf("sms")!==-1){m.sms=true;l.find(".hint-sms").text(s.details);}else{if(q.indexOf("telephone")!==-1){m.telephone=true;}}}}});$.each(m,function(r,q){if(!q){n.find(".factor[data-factor="+r+"]").hide();
}});if(error){j=j-25;}c.find(".btn-toolbar .signin").text("Authenticate");c.find(".inputs").animate({height:$(".login .inputs").height()+j},250);c.find(".inputs .error").fadeOut();
$(".twofactorparent").fadeIn();}else{if(o.Login.Session.length>0){session=o.Login.Session;$(document).trigger("LiveHelp.LoginComplete",session);operator={id:o.Login.ID,username:b,name:o.Login.Name,access:parseInt(o.Login.Access,10)};
$.jStorage.set("protocol",protocol);$.jStorage.set("server",server);$.jStorage.set("session",session);$.jStorage.set("operator",operator);signInComplete();
var k="Offline (Hidden)";switch(o.Login.Status){case 1:k="Online";break;case 2:k="BRB";break;case 3:k="Away";break;}k=(k==="BRB")?"Be Right Back":k;$(".operator .status").text(k);
}}}},error:function(l,j,k){signInError(l);},dataType:"json"});}function signOut(){$(document).trigger("LiveHelp.SignOut");session="";$.jStorage.set("protocol","");
$.jStorage.set("server","");$.jStorage.set("session","");$.jStorage.set("accounts","");$.jStorage.set("operator","");document.location.href="index.html";
$(".loading").hide();$(".content").animate({opacity:0},250);$(".login").fadeIn();}function twoFactorError(){var a=$(".login .inputs"),b=$(".twofactorcode");
a.effect("shake",{times:3,distance:10},150);b.find(".status").hide();b.find(".code").fadeIn();}function twofactorAuth(){var a=(server.length>0)?protocol+server+"/livehelp/admin/duo/index.php":"./duo/index.php",e=$(".twofactorcode"),d=e.find("#twofactor"),c=d.val(),b="";
if(session.length>0){b="session="+session;}else{return;}if(factor.length>0){b+="&factor="+factor;if(factor==="token"||factor==="sms"){e.find(".code").fadeOut(function(){e.find(".status span").text("Authenticating...");
e.find(".status").fadeIn();});}}d.val("");if(c.length>0){b+="&code="+c;}e.find(".status img").animate({opacity:0.5},250);$.ajax({url:a,data:b,type:"POST",success:function(h){var g=$(".twofactorcode"),f=g.find(".status");
if(h.result!==undefined){f.find("img").animate({opacity:0},250);g.find(".code label").text(h.status);if(h.result=="allow"){twoFactorComplete();}else{twoFactorError();
}return;}if(h.session.length>0){session=h.session;window.setTimeout(twofactorStatus,2000);}},dataType:"json"});}function twofactorStatus(){var a=(server.length>0)?protocol+server+"/livehelp/admin/duo/index.php":"./duo/index.php",b="";
if(session.length>0){b="session="+session;}else{return;}$.ajax({url:a,data:b,type:"POST",success:function(d){var c=$(".twofactorcode .status");if(d.result!==undefined){c.find("img").animate({opacity:0},250);
c.find("label").text(d.status);if(d.result==="allow"){twoFactorComplete();}else{twoFactorError();}}else{window.setTimeout(twofactorStatus,2000);}c.find("label").text(d.status);
},dataType:"json"});}function twoFactorComplete(){$(".login").fadeOut();$(".content").animate({opacity:1},250);}var messageSound,pendingSound;function convertHostname(b){var a=b.Hostname,c=ucwords(b.Username);
if(c!==null&&c.length>0){a=c+" - "+a;}return a;}function convertBrowserIcon(c,b){var a="Chrome",d="";if(c.indexOf("MSIE")!==-1){a="InternetExplorer";}else{if(c.indexOf("Chrome")!==-1){a="Chrome";
}else{if(c.indexOf("Opera")!==-1){a="Opera";}else{if(c.indexOf("Safari")!==-1){a="Safari";}else{if(c.indexOf("Firefox")!==-1){a="Firefox";}}}}}if(b){d="./images/"+a+"Small.png";
}else{d="./images/"+a+".png";}return d;}function convertReferrer(b){var c=/^http[s]{0,1}:\/\/(?:[^.]+[\\.])*google(?:(?:.[a-z]{2,3}){1,2})[\/](?:search|url|imgres|aclk)(?:\?|.*&)q=([^&]*)/i;
var a=c.exec(b);if(a!==null){if(a[1].length>0){b="Google Search (Keywords: "+a[1]+")";}else{b="Google Search";}}return b;}function convertCountryIcon(c){var b={"Ascension Island":"ac",Andorra:"ad","United Arab Emirates":"ae",Afghanistan:"af","Antigua And Barbuda":"ag",Anguilla:"ai",Albania:"al",Armenia:"am","Netherlands Antilles":"an",Angola:"ao",Antarctica:"aq",Argentina:"ar","American Samoa":"as",Austria:"at",Australia:"au",Aruba:"aw","Aland Islands":"ax",Azerbaijan:"az","Bosnia And Herzegovina":"ba",Barbados:"bb",Bangladesh:"bd",Belgium:"be","Burkina Faso":"bf",Bulgaria:"bg",Bahrain:"bh",Burundi:"bi",Benin:"bj",Bermuda:"bm","Brunei Darussalam":"bn",Bolivia:"bo",Brazil:"br",Bahamas:"bs",Bhutan:"bt","Bouvet Island":"bv",Botswana:"bw",Belarus:"by",Belize:"bz",Canada:"ca","Cocos (keeling) Islands":"cc","Congo, The Democratic Republic of The":"cd","Central African Republic":"cf","Congo, Republic of The":"cg",Switzerland:"ch","Cote D'ivoire":"ci","Cook Islands":"ck",Chile:"cl",Cameroon:"cm",China:"cn",Colombia:"co","Costa Rica":"cr",Cuba:"cu","Cape Verde":"cv","Christmas Island":"cx",Cyprus:"cy","Czech Republic":"cz",Germany:"de",Djibouti:"dj",Denmark:"dk",Dominica:"dm","Dominican Republic":"do",Algeria:"dz",Ecuador:"ec",Estonia:"ee",Egypt:"eg","Western Sahara":"eh",Eritrea:"er",Spain:"es",Ethiopia:"et",Europe:"eu",Finland:"fi",Fiji:"fj","Falkland Islands ( Malvinas )":"fk","Micronesia, Federated States of":"fm","Faroe Islands":"fo",France:"fr",Gabon:"ga",Grenada:"gd",Georgia:"ge","French Guiana":"gf",Ghana:"gh",Gibraltar:"gi",Greenland:"gl",Gambia:"gm",Guinea:"gn",Guadeloupe:"gp","Equatorial Guinea":"gq",Greece:"gr","South Georgia And The South Sandwich Islands":"gs",Guatemala:"gt",Guam:"gu","Guinea-bissau":"gw",Guyana:"gy","Hong Kong":"hk","Heard Island And Mcdonald Islands":"hm",Honduras:"hn",Croatia:"hr",Haiti:"ht",Hungary:"hu",Indonesia:"id","Ireland, Republic of":"ie",Ireland:"ie",Israel:"il",India:"in","British Indian Ocean Territory":"io",Iraq:"iq","Iran, Islamic Republic of":"ir",Iceland:"is",Italy:"it",Jamaica:"jm",Jordan:"jo",Japan:"jp",Kenya:"ke",Kyrgyzstan:"kg",Cambodia:"kh",Kiribati:"ki",Comoros:"km","Saint Kitts And Nevis":"kn","Korea, Democratic People's Republic of":"kp","Korea, Republic of":"kr",Kuwait:"kw","Cayman Islands":"ky",Kazakhstan:"kz","Lao People's Democratic Republic":"la",Lebanon:"lb","Saint Lucia":"lc",Liechtenstein:"li","Sri Lanka":"lk",Liberia:"lr",Lesotho:"ls",Lithuania:"lt",Luxembourg:"lu",Latvia:"lv","Libyan Arab Jamahiriya":"ly",Morocco:"ma",Monaco:"mc","Moldova, Republic of":"md","Montenegro, Republic of":"me",Madagascar:"mg","Marshall Islands":"mh",Macedonia:"mk","Macedonia, Republic of":"mk",Mali:"ml",Myanmar:"mm",Mongolia:"mn",Macau:"mo","Northern Mariana Islands":"mp",Martinique:"mq",Mauritania:"mr",Montserrat:"ms",Malta:"mt",Mauritius:"mu",Maldives:"mv",Malawi:"mw",Mexico:"mx",Malaysia:"my",Mozambique:"mz",Namibia:"na","New Caledonia":"nc",Niger:"ne","Norfolk Island":"nf",Nigeria:"ng",Nicaragua:"ni",Netherlands:"nl",Norway:"no",Nepal:"np",Nauru:"nr",Niue:"nu","New Zealand":"nz",Oman:"om",Panama:"pa",Peru:"pe","French Polynesia":"pf","Papua New Guinea":"pg",Philippines:"ph",Pakistan:"pk",Poland:"pl","Saint Pierre And Miquelon":"pm",Pitcairn:"pn","Puerto Rico":"pr","Palestinian Territory, Occupied":"ps","Palestinian Territory":"ps",Portugal:"pt",Palau:"pw",Paraguay:"py",Qatar:"qa",Reunion:"re",Romania:"ro",Serbia:"rs","Serbia, Republic of":"rs","Russian Federation":"ru",Rwanda:"rw","Saudi Arabia":"sa","Solomon Islands":"sb",Seychelles:"sc",Sudan:"sd",Sweden:"se",Singapore:"sg","Saint Helena":"sh",Slovenia:"si","Svalbard And Jan Mayen":"sj",Slovakia:"sk","Sierra Leone":"sl","San Marino":"sm",Senegal:"sn",Somalia:"so",Suriname:"sr","Sao Tome And Principe":"st","El Salvador":"sv","Syrian Arab Republic":"sy",Swaziland:"sz","Turks And Caicos Islands":"tc",Chad:"td","French Southern Territories":"tf",Togo:"tg",Thailand:"th",Tajikistan:"tj",Tokelau:"tk","Timor - Leste ( East Timor )":"tl",Turkmenistan:"tm",Tunisia:"tn",Tonga:"to",Turkey:"tr","Trinidad And Tobago":"tt",Tuvalu:"tv",Taiwan:"tw","Taiwan, Province of China":"tw","Tanzania, United Republic of":"tz",Ukraine:"ua",Uganda:"ug","United Kingdom":"uk","United States Minor Outlying Islands":"um","United States":"us",Uruguay:"uy",Uzbekistan:"uz","Holy See ( Atican City State )":"va","Saint Vincent And The Grenadines":"vc",Venezuela:"ve","Virgin Islands, British":"vg","Virgin Islands, United States":"vi",Vietnam:"vn",Vanuatu:"vu","Wallis And Futuna":"wf",Samoa:"ws",Yemen:"ye",Mayotte:"yt","South Africa":"za",Zambia:"zm",Zimbabwe:"zw"},d=b[c],a=c;
if(d===undefined||d==="Unavailable"){a="";}else{if(d!==undefined){a="sprite "+d;}}return a;}function convertCountry(b){var a=b.Country;if(b.State.length>0){if(b.City.length>0){a=b.City+", "+b.State+", "+b.Country;
}else{a=b.State+", "+b.Country;}}else{if(b.City.length>0){a=b.City+", "+b.Country;}}return a;}